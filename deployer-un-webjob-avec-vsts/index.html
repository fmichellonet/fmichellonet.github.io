<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Déployer un webjob avec VSTS</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="..\favicon.ico">

    <link rel="stylesheet" type="text/css" href="..\assets\css\screen.css?v=e6afc982da">
    <link rel="stylesheet" type="text/css" href="..\assets\css\prism.css?v=e6afc982da">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">

    <link rel="shortcut icon" href="..\favicon.ico" type="image/x-icon">
    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp\index.html">
    
    <meta property="og:site_name" content="mymemoryleaks">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Déployer un webjob avec VSTS">
    <meta property="og:description" content="Si vous avez déjà eu besoin de déployer un azure webjob via vsts, vous avez du tomber sur ce bon blog post de Thomas Hellstrøm. Néanmoins, en suivant telles quelles les instructions de notre ami Thomas, vous risquer de casser la webapp qui host votre webjob. Ce blog post va">
    <meta property="og:url" content="http://localhost:2368/deployer-un-webjob-avec-vsts/">
    <meta property="article:published_time" content="2018-02-09T22:52:00.000Z">
    <meta property="article:modified_time" content="2018-02-14T21:27:53.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Déployer un webjob avec VSTS">
    <meta name="twitter:description" content="Si vous avez déjà eu besoin de déployer un azure webjob via vsts, vous avez du tomber sur ce bon blog post de Thomas Hellstrøm. Néanmoins, en suivant telles quelles les instructions de notre ami Thomas, vous risquer de casser la webapp qui host votre webjob. Ce blog post va">
    <meta name="twitter:url" content="http://localhost:2368/deployer-un-webjob-avec-vsts/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Fabrice Michellonet">
    <meta name="twitter:site" content="@MyMemoryLeaks">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "mymemoryleaks",
        "logo": "http://localhost:2368/content/images/2018/02/mosquito.png"
    },
    "author": {
        "@type": "Person",
        "name": "Fabrice Michellonet",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/65244b78c89aff8f81952bd8a452ac0a?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://localhost:2368/author/fabrice/",
        "sameAs": []
    },
    "headline": "Déployer un webjob avec VSTS",
    "url": "http://localhost:2368/deployer-un-webjob-avec-vsts/",
    "datePublished": "2018-02-09T22:52:00.000Z",
    "dateModified": "2018-02-14T21:27:53.000Z",
    "description": "Si vous avez déjà eu besoin de déployer un azure webjob via vsts, vous avez du tomber sur ce bon blog post de Thomas Hellstrøm. Néanmoins, en suivant telles quelles les instructions de notre ami Thomas, vous risquer de casser la webapp qui host votre webjob. Ce blog post va",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <script type="text/javascript" src="..\public\ghost-sdk.js?v=e6afc982da"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "85ce418ba3bc"
});
</script>
    <meta name="generator" content="Ghost 1.21">
    <link rel="alternate" type="application/rss+xml" title="mymemoryleaks" href="..\rss\index.xml">
</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home"><a href="..\index.html">Home</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="..\rss\index.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <div class="main-header-background-square"></div>
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="..\index.html"><img src="..\content\images\2018\02\mosquito.png" alt="mymemoryleaks"></a>
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Déployer un webjob avec VSTS</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2018-02-09">09 février 2018</time> 
            </section>
        </header>

        <section class="post-content">
            <div class="kg-card-markdown"><p>Si vous avez déjà eu besoin de déployer un <a href="https://docs.microsoft.com/fr-fr/azure/app-service/web-sites-create-web-jobs">azure webjob</a> via vsts, vous avez du tomber sur ce <a href="https://medium.com/@thomashellstrom/building-azure-webjobs-in-vsts-4306e141df49">bon blog post de Thomas Hellstrøm</a>. Néanmoins, en suivant telles quelles les instructions de notre ami Thomas, vous risquer de casser la webapp qui host votre webjob.</p>
<p>Ce blog post va prendre la tournure d’une recette de cuisine, d’un pense bête ; cela m’évitera de me reposer la même question dans quelques mois, et j'espère secrètement que cela puisse aider certains d'entre vous.</p>
<p>On commence donc par utiliser la fonction « Publish as Azure Webjob » à partir de Visual Studio 2017.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=1oxmVOgeleLcE0HoiBmqXgw4NdZPzV1f6" alt=""></p>
<p>Pas la peine d’aller au bout du deploy, ce tool va ajouter le package nuget <a href="https://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/">Microsoft.Web.WebJobs.Publish</a> et créer le fichier « webjob-publish-settings.json » dans le répertoire properties de votre projet.</p>
<p>On passe ensuite sur le build sur VSTS. Thomas nous propose de définir les arguments suivants sur la tache msbuild :</p>
<pre><code class="language-powershell">/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:Configuration=Release
</code></pre>
<p>Notez le paramètre <cite>/p:WebPublishMethod=Package</cite>, qui produira un fichier zip.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=1Y9grjF4l84j-rI2G-7wRxUalCeD3h2cJ" alt=""></p>
<p>Et en jetant un œil dans le fichier zip, mauvaise surprise, on est en train de packager le dossier bin avec des dll qui vont venir écraser celles qui appartiennent à la webapp.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=13Jx4y2OZzK3HOhF9C1Bnl7yMs6fs_-DQ" alt=""></p>
<p>Du coup j’vous propose de corriger ça.<br>
On commence par changer les arguments de la tache msbuild.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=1-t4EzYGYxTRwzM5iLDSSJzQSPEUDRs3L" alt=""></p>
<pre><code class="language-powershell">/p:DeployOnBuild=true /p:WebPublishMethod=FileSystem /p:publishUrl=&quot;$(build.artifactstagingdirectory)&quot; /p:DeployDefaultTarget=WebPublish
</code></pre>
<p>Ce qui va produire le même contenu que le fichier zip mais directement sur le système de fichier.</p>
<p>Puis on ajoute une tache delete file, qui se chargera de supprimer le dossier /bin que nous voulons éviter de déployer.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=13y7Jd2gEmFBlOKOeAr2EVsypWOf63FTZ" alt=""></p>
<p>Voila, cette fois ci nous y sommes. J’espère que cela pourra vous aider!</p>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="..\author\fabrice\index.html" style="background-image: url(//www.gravatar.com/avatar/65244b78c89aff8f81952bd8a452ac0a?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x)"><span class="hidden">Fabrice Michellonet's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="..\author\fabrice\index.html">Fabrice Michellonet</a></h4>

                    <p>Read <a href="..\author\fabrice\index.html">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=D%C3%A9ployer%20un%20webjob%20avec%20VSTS&amp;url=http://localhost:2368/deployer-un-webjob-avec-vsts/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/deployer-un-webjob-avec-vsts/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:2368/deployer-un-webjob-avec-vsts/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>
    </article>
</main>

<aside class="read-next">
    <a class="read-next-story prev no-cover" href="..\vsts-quand-ya-plus-de-credits-yen-a-encore\index.html">
        <section class="post">
            <h2>VSTS – Quand y’a plus de crédits, y’en a encore.</h2>
            <p>Ça, c’est la poisse: Your account has no free minutes remaining. Le scénario est à se pendre, tu&hellip;</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="..\index.html">mymemoryleaks</a> &copy; 2018</section>
            <section class="poweredby">Powered by <a href="http://boo-demo.tenoku.com/">Ghost + Boo</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="..\assets\js\jquery.fitvids.js?v=e6afc982da"></script>
    <script type="text/javascript" src="..\assets\js\index.js?v=e6afc982da"></script>
    <script type="text/javascript" src="..\assets\js\prism.js?v=e6afc982da"></script>
    <script src="https://cdn.jsdelivr.net/mobile-detect.js/1.3.3/mobile-detect.min.js"></script>
    <script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>

</body>
</html>
