<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>VSTS – Quand y’a plus de crédits, y’en a encore.</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="..\favicon.ico">

    <link rel="stylesheet" type="text/css" href="..\assets\css\screen.css?v=e6afc982da">
    <link rel="stylesheet" type="text/css" href="..\assets\css\prism.css?v=e6afc982da">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">

    <link rel="shortcut icon" href="..\favicon.ico" type="image/x-icon">
    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp\index.html">
    
    <meta property="og:site_name" content="mymemoryleaks">
    <meta property="og:type" content="article">
    <meta property="og:title" content="VSTS – Quand y’a plus de crédits, y’en a encore.">
    <meta property="og:description" content="Ça, c’est la poisse: Your account has no free minutes remaining. Le scénario est à se pendre, tu montes ton projet en intégration continue et après quelques (dizaines) de commit tu te retrouves dans l’impossibilité de complétera une PR ou juste vérifier que le dernier commit n’a">
    <meta property="og:url" content="http://localhost:2368/vsts-quand-ya-plus-de-credits-yen-a-encore/">
    <meta property="article:published_time" content="2018-01-29T23:14:00.000Z">
    <meta property="article:modified_time" content="2018-02-14T21:20:15.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="VSTS – Quand y’a plus de crédits, y’en a encore.">
    <meta name="twitter:description" content="Ça, c’est la poisse: Your account has no free minutes remaining. Le scénario est à se pendre, tu montes ton projet en intégration continue et après quelques (dizaines) de commit tu te retrouves dans l’impossibilité de complétera une PR ou juste vérifier que le dernier commit n’a">
    <meta name="twitter:url" content="http://localhost:2368/vsts-quand-ya-plus-de-credits-yen-a-encore/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Fabrice Michellonet">
    <meta name="twitter:site" content="@MyMemoryLeaks">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "mymemoryleaks",
        "logo": "http://localhost:2368/content/images/2018/02/mosquito.png"
    },
    "author": {
        "@type": "Person",
        "name": "Fabrice Michellonet",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/65244b78c89aff8f81952bd8a452ac0a?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://localhost:2368/author/fabrice/",
        "sameAs": []
    },
    "headline": "VSTS – Quand y’a plus de crédits, y’en a encore.",
    "url": "http://localhost:2368/vsts-quand-ya-plus-de-credits-yen-a-encore/",
    "datePublished": "2018-01-29T23:14:00.000Z",
    "dateModified": "2018-02-14T21:20:15.000Z",
    "description": "Ça, c’est la poisse: Your account has no free minutes remaining. Le scénario est à se pendre, tu montes ton projet en intégration continue et après quelques (dizaines) de commit tu te retrouves dans l’impossibilité de complétera une PR ou juste vérifier que le dernier commit n’a",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <script type="text/javascript" src="..\public\ghost-sdk.js?v=e6afc982da"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "85ce418ba3bc"
});
</script>
    <meta name="generator" content="Ghost 1.21">
    <link rel="alternate" type="application/rss+xml" title="mymemoryleaks" href="..\rss\index.xml">
</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home"><a href="..\index.html">Home</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="..\rss\index.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <div class="main-header-background-square"></div>
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="..\index.html"><img src="..\content\images\2018\02\mosquito.png" alt="mymemoryleaks"></a>
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post">

        <header class="post-header">
            <h1 class="post-title">VSTS – Quand y’a plus de crédits, y’en a encore.</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2018-01-30">30 janvier 2018</time> 
            </section>
        </header>

        <section class="post-content">
            <div class="kg-card-markdown"><p>Ça, c’est la poisse: <code>Your account has no free minutes remaining</code>.</p>
<p>Le scénario est à se pendre, tu montes ton projet en intégration continue et après quelques (dizaines) de commit tu te retrouves dans l’impossibilité de complétera une PR ou juste vérifier que le dernier commit n’a pas introduit de régressions.</p>
<p>Du coup je me propose de présenter ici, comment créer à moindre frais un agent de build sur-vitaminé. Et le fait d’avoir une machine un peu costaud, n’est pas un moindre mal ; qui ne s’est pas arraché les cheveux en attendant que l’agent de build hosté veuille bien se lancer et faire son travail… ?</p>
<p>Plutôt que de créer nous même une vm, installer windows, msbuild et tout le nécessaire a un agent de build, on va plutôt utiliser azure <a href="https://azure.microsoft.com/fr-fr/services/devtest-lab/">DevTest Lab</a>. L’idée est de tirer parti des template de vm qui sont mises a notre dispo.</p>
<p>Après avoir créé votre première instance DevTest lab, on ajoute une vm basée sur l’image Visual Studio Community 2017 (latest release) on Windows Server 2016 (x64).</p>
<p><a href="https://drive.google.com/uc?export=download&amp;id=1yq-8OdL7oeffvZ-lsW8Ll01dy0n6g8KQ"><img src="https://drive.google.com/uc?export=download&amp;id=1yq-8OdL7oeffvZ-lsW8Ll01dy0n6g8KQ" alt=""></a></p>
<p>On va vous demander un login et un mot de passe pour le compte admin de la future vm.<br>
Je vous conseille de stocker votre mot de passe dans le coffre-fort « my secret » pour une plus grande sécurité. (ce n’est donc pas mon mot de passe que vous voyez 😊)</p>
<p>Bon il nous faut maintenant choisir les caractéristiques de la vm. J’ai opté pour 32 GO de ram et 8 vcpu, une D8S_V3, elle ne sera allumée que quelques minutes le temps de faire le build, donc elle ne nous coutera pas bien cher.</p>
<p>Place aux artefacts, il convient de voir cela comme des scripts additionnels qui installeront d’autres programmes/services sur votre vm. Ça tombe bien, l’artefact VSTS Build agent nous procure le service de build qui convient.</p>
<p><a href="https://drive.google.com/uc?export=download&amp;id=1uhrvXnuNP5G6U7X66SdH3tj7XSmK380K"><img src="https://drive.google.com/uc?export=download&amp;id=1uhrvXnuNP5G6U7X66SdH3tj7XSmK380K" alt=""></a></p>
<p>Quelques précisions, le champs VSTS account name doit se conformer au pattern suivant : <code>https://{{vsts_account_name}}.visualstudio.com</code></p>
<p>Le secret correspond une clé privée que vous pourrez crée en vous rendant à l’adresse <code>https://{{vsts_account_name}}.visualstudio.com/_details/security/tokens</code></p>
<p>Finalement, l’agent pool doit être un pool pré-existant. A vérifier/créer ici : <code>https://{{vsts_account_name}}.visualstudio.com/_admin/_AgentPool</code></p>
<p>Petit plus, dans le cas ou vous envisagez de builder des projets front, profitez de cette étape pour ajouter l’artefact NODE JS.</p>
<p>Bon, aller y’a plus qu’a cliquer sur OK, attendre quelques minutes et l’agent devrait apparaitre dans le pool que vous avez choisi.</p>
<p><a href="https://drive.google.com/uc?export=download&amp;id=1fLWtBjZ32fLL-ilmRq1GqPr3-dm8DK3j"><img src="https://drive.google.com/uc?export=download&amp;id=1fLWtBjZ32fLL-ilmRq1GqPr3-dm8DK3j" alt=""></a></p>
<p>Quoi qu’il en soit pas de panique, si vous vous êtes trompé sur un paramètre des artefacts, il sera toujours possible de retenter l’installation a postériori ou bien de procéder a l’installation manuellement.</p>
<p>Dernier point, si vos crédits azure ne vous permettent pas de laisser cette vm allumée tout le temps, voici deux petites commandes qui vous permettront d’allumer et d’éteindre la vm a volonté. (a utiliser dans une console <a href="https://docs.microsoft.com/fr-fr/cli/azure/install-azure-cli?view=azure-cli-latest">azure cli</a></p>
<pre><code class="language-powershell">az lab vm {{command}} --lab-name {{devtestlab}} --name {{vm-name}} --resource-group {{resource-group}}
</code></pre>
<p>command : start ou stop<br>
devtestlab : le nom de votre instance DevTest lab<br>
vm-name : le nom de votre vm<br>
resource-group : le nom du resource group ou est installé la vm.</p>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="..\author\fabrice\index.html" style="background-image: url(//www.gravatar.com/avatar/65244b78c89aff8f81952bd8a452ac0a?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x)"><span class="hidden">Fabrice Michellonet's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="..\author\fabrice\index.html">Fabrice Michellonet</a></h4>

                    <p>Read <a href="..\author\fabrice\index.html">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=VSTS%20%E2%80%93%20Quand%20y%E2%80%99a%20plus%20de%20cr%C3%A9dits%2C%20y%E2%80%99en%20a%20encore.&amp;url=http://localhost:2368/vsts-quand-ya-plus-de-credits-yen-a-encore/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/vsts-quand-ya-plus-de-credits-yen-a-encore/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:2368/vsts-quand-ya-plus-de-credits-yen-a-encore/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>
    </article>
</main>

<aside class="read-next">
    <a class="read-next-story no-cover" href="..\deployer-un-webjob-avec-vsts\index.html">
        <section class="post">
            <h2>Déployer un webjob avec VSTS</h2>
            <p>Si vous avez déjà eu besoin de déployer un azure webjob via vsts, vous avez du tomber sur ce&hellip;</p>
        </section>
    </a>
    <a class="read-next-story prev no-cover" href="..\odata-ngtable-un-duo-de-choc\index.html">
        <section class="post">
            <h2>OData &amp; ngTable : un duo de choc</h2>
            <p>Dernièrement, j’ai pas mal fait joujou avec OData. C’est quand même super plaisant de pouvoir requêter une&hellip;</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="..\index.html">mymemoryleaks</a> &copy; 2018</section>
            <section class="poweredby">Powered by <a href="http://boo-demo.tenoku.com/">Ghost + Boo</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="..\assets\js\jquery.fitvids.js?v=e6afc982da"></script>
    <script type="text/javascript" src="..\assets\js\index.js?v=e6afc982da"></script>
    <script type="text/javascript" src="..\assets\js\prism.js?v=e6afc982da"></script>
    <script src="https://cdn.jsdelivr.net/mobile-detect.js/1.3.3/mobile-detect.min.js"></script>
    <script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>

</body>
</html>
