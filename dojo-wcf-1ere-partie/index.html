<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Dojo + WCF [1ere Partie]</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="..\favicon.ico">

    <link rel="stylesheet" type="text/css" href="..\assets\css\screen.css?v=e6afc982da">
    <link rel="stylesheet" type="text/css" href="..\assets\css\prism.css?v=e6afc982da">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">

    <link rel="shortcut icon" href="..\favicon.ico" type="image/x-icon">
    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp\index.html">
    
    <meta property="og:site_name" content="mymemoryleaks">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Dojo + WCF [1ere Partie]">
    <meta property="og:description" content="Voila déjà plusieurs mois, j’avais une discussion sur les architectures SOA avec Christophe et surtout comment les mettre en œuvre avec les Framework (Ajax) Javascript. A l’époque il démarrait une refonte de sa galerie de photos perso LCCFamilly et souhaitait qu’elle soit Full Ajax. Sur ce même">
    <meta property="og:url" content="http://localhost:2368/dojo-wcf-1ere-partie/">
    <meta property="article:published_time" content="2009-04-08T20:01:00.000Z">
    <meta property="article:modified_time" content="2009-04-08T20:01:00.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Dojo + WCF [1ere Partie]">
    <meta name="twitter:description" content="Voila déjà plusieurs mois, j’avais une discussion sur les architectures SOA avec Christophe et surtout comment les mettre en œuvre avec les Framework (Ajax) Javascript. A l’époque il démarrait une refonte de sa galerie de photos perso LCCFamilly et souhaitait qu’elle soit Full Ajax. Sur ce même">
    <meta name="twitter:url" content="http://localhost:2368/dojo-wcf-1ere-partie/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Fabrice Michellonet">
    <meta name="twitter:site" content="@MyMemoryLeaks">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "mymemoryleaks",
        "logo": "http://localhost:2368/content/images/2018/02/mosquito.png"
    },
    "author": {
        "@type": "Person",
        "name": "Fabrice Michellonet",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/65244b78c89aff8f81952bd8a452ac0a?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://localhost:2368/author/fabrice/",
        "sameAs": []
    },
    "headline": "Dojo + WCF [1ere Partie]",
    "url": "http://localhost:2368/dojo-wcf-1ere-partie/",
    "datePublished": "2009-04-08T20:01:00.000Z",
    "dateModified": "2009-04-08T20:01:00.000Z",
    "description": "Voila déjà plusieurs mois, j’avais une discussion sur les architectures SOA avec Christophe et surtout comment les mettre en œuvre avec les Framework (Ajax) Javascript. A l’époque il démarrait une refonte de sa galerie de photos perso LCCFamilly et souhaitait qu’elle soit Full Ajax. Sur ce même",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <script type="text/javascript" src="..\public\ghost-sdk.js?v=e6afc982da"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "85ce418ba3bc"
});
</script>
    <meta name="generator" content="Ghost 1.21">
    <link rel="alternate" type="application/rss+xml" title="mymemoryleaks" href="..\rss\index.xml">
</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home"><a href="..\index.html">Home</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="..\rss\index.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <div class="main-header-background-square"></div>
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="..\index.html"><img src="..\content\images\2018\02\mosquito.png" alt="mymemoryleaks"></a>
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Dojo + WCF [1ere Partie]</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2009-04-08">08 avril 2009</time> 
            </section>
        </header>

        <section class="post-content">
            <div class="kg-card-markdown"><p>Voila déjà plusieurs mois, j’avais une discussion sur les architectures SOA avec Christophe et surtout comment les mettre en œuvre avec les Framework (Ajax) Javascript. A l’époque il démarrait une refonte de sa galerie de photos perso <a href="http://lccfamily.net/">LCCFamilly</a> et souhaitait qu’elle soit Full Ajax.</p>
<p>Sur ce même principe, je me propose aujourd’hui de vous montrer comment interroger un WebService <a href="http://msdn.microsoft.com/fr-fr/netframework/aa663324.aspx">WCF</a> à partir du Framework <a href="http://www.dojotoolkit.org/">Dojo</a> ; Faisons un service qui nous donne l’heure et la date courante formatée selon la locale du serveur. On commence par déclarer l’interface de notre service.</p>
<p>[ServiceContract(Namespace=&quot;<a href="http://www.devolis.com/2009/04/WCFDOJO">http://www.devolis.com/2009/04/WCFDOJO</a>&quot;)]<br>
public interface IClockService<br>
{<br>
[OperationContract]<br>
[WebInvoke(Method = &quot;POST&quot;)]<br>
string GetTime();<br>
}</p>
<p>Notez l’utilisation du verbe POST ; Il convient d’éviter le verbe GET comme la peste si vous utilisez Internet Explorer comme client de votre WebService. En effet, sa gestion du cache, fait qu’il n’effectue que le premier appel, puis se contente de renvoyer ce qu’il a en cache.</p>
<p>Puis passons à l’implémentation à proprement dit du service</p>
<p>/// AspNetCompatibilityRequirements n'est utile que si le webservice est hosté dans IIS<br>
[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]<br>
public class ClockService : IClockService<br>
{<br>
public string GetTime()<br>
{<br>
return DateTime.Now.ToString();<br>
}<br>
}</p>
<p>Ok, a ce moment précis, il vous est déjà possible de tester le WebService en créant rapidement un projet console et en ajoutant une WebReference sur ce dernier... Je vous laisse le faire de votre coté 🙂</p>
<p>Passons à notre page web :</p>
<html xmlns="http://www.w3.org/1999/xhtml">  
 <title>Dojo & WCF</title>  
 <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.3.0/dojo/dojo.xd.js" type="text/javascript"></script>  
 <script type="text/javascript">  
 dojo.require('dojo.parser');  
 </script>  
 <script type="text/javascript">  
  
 function GetTime() {  
 dojo.xhrPost({  
 url: "ClockService.svc/GetTime",  
 handleAs: "text",  
 contentType: "application/json; charset=utf-8",  
 load: function(response, ioArgs) {  
 dojo.byId('ServerTime').innerHTML = dojo.fromJson(response).d;  
 return response;  
 },  
 error: function(response, ioArgs) {  
 alert("Error :" + ioArgs.xhr.status);  
 return response;  
 }  
 });  
 }  
  
 </script>  
<body onload="GetTime();">  
 <input type="button" value="Time?" onclick="GetTime();">  
 <div id="ServerTime"></div>  
<p>Comme vous pouvez le constater, le code est assez concis. Apres avoir déclaré l’utilisation de Dojo 1.3 à partir du CDN de <a href="http://code.google.com/intl/fr/apis/ajaxlibs/documentation/">Google</a>, j’ai déclaré une fonction GetTime() qui par le biais d’un <a href="http://fr.wikipedia.org/wiki/XMLHttpRequest">XmlHttpRequest</a> (xhr) va demander au WebService de lui retourner le DateTime actuel ; les données sont attendues sous forme de <a href="http://fr.wikipedia.org/wiki/JavaScript_Object_Notation">JSon</a>.</p>
<p>Vous remarquerez aussi la construction de l’url d’appel, il s’agit du nom du Service suivit par le nom de la méthode.</p>
<p>Si vous exécutez maintenant la page web, vous recevrez une erreur http 405. En effet pour l’instant Dojo et WCF ne parlent pas encore la même langue. Dojo parle en JSon et WCF en <a href="http://fr.wikipedia.org/wiki/SOAP">Soap</a>... il va nous falloir configurer le service.</p>
<p>Voici la globalité du ServiceModel que vous trouverez dans votre web.config ou app.config en fonction du type de projet choisit.</p>
<p>&lt;system.serviceModel&gt;</p>
 <behaviors>  
 <servicebehaviors>  
 <behavior name="MetaDataBehavior">  
 <servicemetadata httpgetenabled="true"></servicemetadata>  
 </behavior>  
 </servicebehaviors>  
 <endpointbehaviors>  
 <behavior name="ClockServiceBehavior">  
 <enablewebscript></enablewebscript>  
 </behavior>  
 </endpointbehaviors>  
 </behaviors>  
 <services>  
 <service name="WCF_TEST.ClockService" behaviorconfiguration="MetaDataBehavior">  
 <endpoint address="" behaviorconfiguration="ClockServiceBehavior" binding="webHttpBinding" name="ClockService" contract="WCF_TEST.IClockService"></endpoint>  
 </service>  
 </services>  
<p>&lt;/system.serviceModel&gt;</p>
<p>La principale différence avec la configuration standard est au niveau du binding du endpoint. Par défaut le binding est définit en tant que <a href="http://msdn.microsoft.com/fr-fr/library/system.servicemodel.wshttpbinding.aspx">wsHttpBinding</a> (messages soap) ; Pour parler Json il nous faut choisir le binding <a href="http://msdn.microsoft.com/fr-fr/library/system.servicemodel.webhttpbinding.aspx">webHttpBinding</a> (JSon).</p>
<p>Voila, relancez la page web… tadam… c’est magique.</p>
<p>Dans la prochaine partie de cet article je tacherais de vous montrer comment éviter d’avoir à écrire les blocs de javascript xhrPost en passant par <a href="http://www.dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/ajax-transports/remote-procedure-call-rpc">dojo.rpc</a></p>
<p>Christophe, t’as plus qu’a réécrire LCCFamily 🙂</p>
</body></html></div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="..\author\fabrice\index.html" style="background-image: url(//www.gravatar.com/avatar/65244b78c89aff8f81952bd8a452ac0a?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x)"><span class="hidden">Fabrice Michellonet's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="..\author\fabrice\index.html">Fabrice Michellonet</a></h4>

                    <p>Read <a href="..\author\fabrice\index.html">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Dojo%20%2B%20WCF%20%5B1ere%20Partie%5D&amp;url=http://localhost:2368/dojo-wcf-1ere-partie/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/dojo-wcf-1ere-partie/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:2368/dojo-wcf-1ere-partie/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>
    </article>
</main>

<aside class="read-next">
    <a class="read-next-story no-cover" href="..\dojo-wcf-2eme-partie\index.html">
        <section class="post">
            <h2>Dojo + WCF [2eme Partie]</h2>
            <p>Dans le précèdent billet, je vous avais proposé d’invoquer un service WCF en utilisant les XmlHttpRequest à la&hellip;</p>
        </section>
    </a>
    <a class="read-next-story prev no-cover" href="..\microsoft-web-platform-installer\index.html">
        <section class="post">
            <h2>Microsoft Web Platform Installer</h2>
            <p>Il y a quelques jours, je suis tombé un peu par hazard sur la page Microsoft Web Platform Installer.&hellip;</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="..\index.html">mymemoryleaks</a> &copy; 2018</section>
            <section class="poweredby">Powered by <a href="http://boo-demo.tenoku.com/">Ghost + Boo</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="..\assets\js\jquery.fitvids.js?v=e6afc982da"></script>
    <script type="text/javascript" src="..\assets\js\index.js?v=e6afc982da"></script>
    <script type="text/javascript" src="..\assets\js\prism.js?v=e6afc982da"></script>
    <script src="https://cdn.jsdelivr.net/mobile-detect.js/1.3.3/mobile-detect.min.js"></script>
    <script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>



</body></html>