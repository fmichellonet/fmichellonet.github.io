<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[mymemoryleaks]]></title><description><![CDATA[Blog sur les technos Microsoft.]]></description><link>http://www.mymemoryleaks.fr/</link><image><url>http://www.mymemoryleaks.fr/favicon.png</url><title>mymemoryleaks</title><link>http://www.mymemoryleaks.fr/</link></image><generator>Ghost 1.21</generator><lastBuildDate>Mon, 16 Jul 2018 21:43:33 GMT</lastBuildDate><atom:link href="http://www.mymemoryleaks.fr/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Migrations EF Core depuis Octopus]]></title><description><![CDATA[Exécutez les migrations EF Core durant la phase de déploiement dans Octopus.]]></description><link>http://www.mymemoryleaks.fr/migrations-ef-core-depuis-octopus/</link><guid isPermaLink="false">5b4cf83018d3df3d74b0ff1c</guid><category><![CDATA[octopus]]></category><category><![CDATA[C#]]></category><category><![CDATA[EF]]></category><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Mon, 16 Jul 2018 21:24:55 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1469073082817-a29a4270b679?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ&amp;s=5814dcb74e57b8c83d4b6f0fb0f42b37" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="https://images.unsplash.com/photo-1469073082817-a29a4270b679?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ&s=5814dcb74e57b8c83d4b6f0fb0f42b37" alt="Migrations EF Core depuis Octopus"><p>Ca vous est déjà arrivé de déployer en prod une nouvelle version de votre application et d'oublier de passer la migration <a href="https://docs.microsoft.com/en-us/ef/#pivot=efcore">EF</a> à la mano ? Eh ben moi aussi. On se retrouve alors à executer le script sql de migration en urgence, en espérant que tout se passera bien. Bref, c'est la panique à bord!</p>
<p>Histoire de ne plus revivre cette situation inconfortable, on est tenté d'avoir recours à la migration EF par le code. Ainsi, on est certains qu'a chaque exécution de notre app, la migration sera effectuée si le schéma de la BDD n'est pas à jour. Le problème, c'est que si la migration se passe mal, on se retrouve à nouveau avec une application plantée en production → retour à la case départ.</p>
<p>Et si on pouvait appliquer la migration EF par le code, mais <em>pendant</em> le déploiement. Après tout, avec la cli dotnet, il est tout à fait possible d'exécuter une migration. Alors pourquoi ne pas le faire à travers un script powershell durant le deploy ? Si vous utilisez <a href="https://octopus.com/">Octopus</a> comme chez <a href="https://www.younited-credit.com/">Younited Credit</a>, alors c'est possible !</p>
<h1 id="migrationavecladotnetcli">Migration avec la dotnet cli</h1>
<p>Supposons que vous ayez découpé classiquement votre application en couche de manière à avoir votre startup project et votre DAL séparés, par exemple :</p>
<ul>
<li>MyCompany.AppOfTheFuture : application console en .NET Core</li>
<li>MyCompany.AppOfTheFuture.DAL : Votre Data Access Layer, celle qui contient vos repositories Entity Framework, votre DbContext et votre code de migration</li>
</ul>
<p>Afin d'exécuter une migration avec la cli .NET Core, on peut utiliser la commande suivante depuis PowerShell :</p>
<pre><code class="language-powershell">dotnet.exe exec `
    --depsfile &quot;MyCompany.AppOfTheFuture.deps.json&quot; `
    --runtimeconfig &quot;MyCompany.AppOfTheFuture.runtimeconfig.json&quot; `
    &quot;${env:ProgramFiles}\dotnet\sdk\NuGetFallbackFolder\microsoft.entityframeworkcore.tools\2.1.1\tools\netcoreapp2.0\any\ef.dll&quot; database update `
    --context AppOfTheFutureContext `
    --verbose `
    --no-color `
    --prefix-output `
    --assembly &quot;MyCompany.AppOfTheFuture.DataAccess.dll&quot; `
    --startup-assembly &quot;MyCompany.AppOfTheFuture.dll&quot; `
    --project-dir &quot;.&quot; `
    --root-namespace MyCompany.AppOfTheFuture.DataAccess
</code></pre>
<p>La ressource <code>ef.dll</code> peut être considérée comme l'équivalent de <a href="https://msdn.microsoft.com/en-us/library/jj618307(v=vs.113).aspx"><code>migrate.exe</code></a> pour EF6. C'est la dedans que se trouve le code qui sera exécuté pour appliquer la migration en base de donnée. Il est important de renseigner le chemin correct de la DLL selon la version de .Net core que vous avez installé.</p>
<p>Les paramètres importants de la commande sont :</p>
<ul>
<li><code>ef.dll database update</code> : définit le type d'opération à appliquer sur la BDD.  Parmis les options possibles, il existe également la commande <code>create</code> afin d'initialiser une BDD.</li>
<li><code>--context AppOfTheFutureContext</code> Définit la classe de contexte EF</li>
<li><code>--assembly &quot;MyCompany.AppOfTheFuture.DataAccess.dll&quot;</code> Définit le nom de l'assembly contenant la classe contexte</li>
<li><code>--startup-assembly &quot;MyCompany.AppOfTheFuture.dll&quot;</code> Définit le nom de votre startup project. En outre, il s'agira vraisemblablement du projet où se trouve votre <code>appsettings.json</code> et la chaîne de connexion à la BDD.</li>
</ul>
<p>A la suite de l'exécution de cette commande, si tout s'est bien passé, votre BDD doit être à jour et aligné sur la dernière migration.</p>
<h1 id="intgrationdelamigrationdansoctopus">Intégration de la migration dans Octopus</h1>
<p>Maintenant que nous savons jouer une migration en CLI, la migration depuis Octopus n'est plus très compliquée à mettre en place. En effet, il suffit de jouer un bout de script PowerShell pendant la tâche de déploiement et c'est joué !</p>
<p>A titre d'exemple, on va se baser sur le déploiement d'une webapp Azure et donc du template Octopus <a href="https://octopus.com/docs/deployment-examples/azure-deployments/deploying-a-package-to-an-azure-web-app#DeployingapackagetoanAzureWebApp-Step4:ConfigureyourAzureWebAppstep">Deploy an Azure Web App</a> :</p>
<p><img src="http://www.mymemoryleaks.fr/content/images/2018/07/deploy-azure-webapp.png" alt="Migrations EF Core depuis Octopus"></p>
<p>Dans ce template, il est possible de renseigner un script PowerShell à exécuter en Pre-Deploy/Deploy/Post-Deploy. On va s'intéresser à la mise en place du script <em>pendant</em> le deploy. Si on le fait trop tôt, on ne pourra pas profiter de la valorisation des variables dans notre <code>appsettings.json</code>.</p>
<p>Il nous suffit juste de recopier la ligne de commande précédemment mentionnée dans la section <strong>Features / Configuration Scripts</strong> et c'est tout bon :</p>
<p><img src="http://www.mymemoryleaks.fr/content/images/2018/07/octopus-custom-script.png" alt="Migrations EF Core depuis Octopus"></p>
<p>L'intérêt de cette approche est de mettre en évidence un problème de base de données rapidement, et surtout avant que votre webapp soit en ligne. <a href="https://en.wikipedia.org/wiki/Fail-fast">Fail Fast!</a> Dans notre cas, si la migration échoue dans Octopus, alors ce dernier ne poursuivra pas le déploiement.</p>
<h4 id="auteurs">Auteurs</h4>
<p>Cet article a été rédigé avec mon ami et collègue <a href="https://hocquet.fr/">Anthony Hocquet</a>. Vous le retrouverez sur son nouveau blog que je vous incite à suivre tant les futurs articles sont prometteurs !</p>
</div>]]></content:encoded></item><item><title><![CDATA[Blazor : Injectez vos interop Javascript]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Commençons par ce qui fait mal. Je dois avouer que ce blog post fait suite à un fail.<br>
Dans cette <a href="https://blogs.msdn.microsoft.com/webdev/2018/04/17/blazor-0-2-0-release-now-available/">version 0.2</a> de Blazor, il y a pas mal de code glue à produire pour pouvoir appeler une fonction javascript à partir de votre code C#.</p>
<p>Cela se passe</p></div>]]></description><link>http://www.mymemoryleaks.fr/blazor-injectez-vos-interop-js/</link><guid isPermaLink="false">5ad8f208dfa53d0bcc07902f</guid><category><![CDATA[Blazor]]></category><category><![CDATA[WebAssembly]]></category><category><![CDATA[C#]]></category><category><![CDATA[Dynamic Proxy]]></category><category><![CDATA[NSubstitute]]></category><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Fri, 20 Apr 2018 12:40:03 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1492515114975-b062d1a270ae?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ&amp;s=24bcab6dc09b4d46b648321080c94d23" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="https://images.unsplash.com/photo-1492515114975-b062d1a270ae?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ&s=24bcab6dc09b4d46b648321080c94d23" alt="Blazor : Injectez vos interop Javascript"><p>Commençons par ce qui fait mal. Je dois avouer que ce blog post fait suite à un fail.<br>
Dans cette <a href="https://blogs.msdn.microsoft.com/webdev/2018/04/17/blazor-0-2-0-release-now-available/">version 0.2</a> de Blazor, il y a pas mal de code glue à produire pour pouvoir appeler une fonction javascript à partir de votre code C#.</p>
<p>Cela se passe en 2 étapes :</p>
<ul>
<li>A partir de votre code javascript, il faut enregistrer une fonction dans le contexte de Blazor.</li>
</ul>
<pre><code class="language-javascript">Blazor.registerFunction('DisplayAlert', (data) =&gt; {
        alert(data);
        return true;
});
</code></pre>
<ul>
<li>Quand vous souhaitez faire appel à cette fonction on utilisera alors un code de ce type, cette fois ci dans votre code C#.</li>
</ul>
<pre><code class="language-csharp">RegisteredFunction.Invoke&lt;bool&gt;(&quot;DisplayAlert&quot;, text);
</code></pre>
<p>On remarque que tout ca fonctionne à base de magic strings (le nom de la methode), que les functions sont obligées de retourner une valeur (void n'est pas prit en compte pour l'instant), et puis ce <em><strong>RegisteredFunction.Invoke</strong></em> c'est vraiment pas super sexy.</p>
<p>Du coup je m'étais dis, ca pourrait être sympa d'au moins <em>cacher</em> <em><strong>RegisteredFunction.Invoke</strong></em>, et voici comment j'imaginais la chose.</p>
<p>On pourrait commencer par définir l'ensemble des fonctions js dans une interface C#, un peu comme ca :</p>
<pre><code class="language-csharp">public interface IAlerter
{
    bool DisplayAlert(string text);
}
</code></pre>
<p>Le choix de l'interface n'est pas complétement anodin, <a href="https://retyped.com">Retyped</a> propose un grand nombre de librairies js exposées sous forme d'interface C#, ce qui nous ouvre la porte a plein de possibilités.</p>
<p>Pour en revenir à notre interface IAlerter, on peut l'injectée dans notre component Blazor à l'aide de l'attribut ***[Inject]***, comme ceci.</p>
<pre><code class="language-csharp">public class Interoper : BlazorComponent
{
    [Inject]
    protected IAlerter Alerter { get; set; }

    public string Sometext { get; set; }

    public virtual void Say()
    {
        Alerter.DisplayAlert(Sometext);
    }
}
</code></pre>
<p>Et finalement il nous ne nous manque qu'un petit helper <em>magique</em> produisant une implémentation de l'interface IAlerter se chargeant de faire les <em><strong>RegisteredFunction.Invoke</strong></em> qui vont bien. Un truc qui pourrait ressembler à ca :</p>
<pre><code class="language-csharp">var alerter = Substitute.For&lt;IAlerter&gt;();
alerter.DisplayAlert(Arg.Any&lt;string&gt;())
       .Returns(info =&gt; RegisteredFunction.Invoke&lt;bool&gt;(&quot;DisplayAlert&quot;, info.ArgAt&lt;string&gt;(0)));
</code></pre>
<p>Evidemment ici, je vous présente la version naïve qui ne fonctionne que pour notre interface, mais avec un peu de reflection on peut rendre cela générique sans trop de mal.</p>
<p>Le fail est sous vos yeux, si vous executez ça dans la console de votre navigateur vous aller voir une très belle exception avec un stack de 3 pieds de long. (<a href="https://sauget-ch.fr/">@Charly</a>, elle est pour toi celle-ci)</p>
<p><img src="http://www.mymemoryleaks.fr/content/images/2018/04/stack.png" alt="Blazor : Injectez vos interop Javascript"></p>
<p>Une grosse <a href="https://msdn.microsoft.com/en-us/library/system.platformnotsupportedexception(v=vs.110).aspx"><em><strong>PlatformNotSupportedException</strong></em></a>! Impossible d' utiliser l'api System.Reflection.Emit avec <a href="http://www.mono-project.com/news/2018/01/16/mono-static-webassembly-compilation/">Mono Webassembly</a>. C'est emmerdant, mais en y reflechissant bien, c'est pas déconnant si on veut maintenir un framework pas trop fat dans le navigateur.</p>
<p>L'expérimentation sur ce point précis s'arrete donc la, mais tout n'est pas à jeter.<br>
Je retiens de cette aventure l'organisation du code. Une interface décrivant l'interop javascript, qui sera injectée dans les BlazorComponent, et une implémentation concrète de l'interface, comme ceci.</p>
<pre><code class="language-csharp">public class Alerter : IAlerter
{
    public bool DisplayAlert(string text)
    {
        return RegisteredFunction.Invoke&lt;bool&gt;(&quot;say&quot;, text);
    }
}
</code></pre>
<p>On est pas allé aussi loin que je ne l'aurais espéré, mais qui sait dans une prochaine version de Blazor cela sera peut etre possible.</p>
</div>]]></content:encoded></item><item><title><![CDATA[Astuce Blazor : Séparer la vue du code]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Depuis quelque temps dans la communauté .NET on <s>parle</s> fait pas mal de marketing autour de <a href="https://visualstudiomagazine.com/articles/2018/03/23/blazor-alpha.aspx">Blazor</a>. Je ne vais pas vous présenter cette nouvelle techno... si vous etes ici, c'est que vous connaissez déjà :).</p>
<p>Une des premières choses qui m'a embété fut de voir dans les articles de présentation</p></div>]]></description><link>http://www.mymemoryleaks.fr/astuce-blazor/</link><guid isPermaLink="false">5ace6f9b90a63023940f731f</guid><category><![CDATA[Blazor]]></category><category><![CDATA[WebAssembly]]></category><category><![CDATA[wasm]]></category><category><![CDATA[C#]]></category><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Wed, 11 Apr 2018 21:17:03 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1489275960192-edc747009a6e?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ&amp;s=c086ae98bdec024e34deb3acef877c4a" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="https://images.unsplash.com/photo-1489275960192-edc747009a6e?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ&s=c086ae98bdec024e34deb3acef877c4a" alt="Astuce Blazor : Séparer la vue du code"><p>Depuis quelque temps dans la communauté .NET on <s>parle</s> fait pas mal de marketing autour de <a href="https://visualstudiomagazine.com/articles/2018/03/23/blazor-alpha.aspx">Blazor</a>. Je ne vais pas vous présenter cette nouvelle techno... si vous etes ici, c'est que vous connaissez déjà :).</p>
<p>Une des premières choses qui m'a embété fut de voir dans les articles de présentation un mélange sans vergogne du code html et du code .NET wrappé dans la section <em><strong>@functions</strong></em></p>
<p>je parle de ca :</p>
<pre><code class="language-csharp">@using System
@page &quot;/guid&quot;


    &lt;h1&gt;Guid Generator&lt;/h1&gt;

    &lt;input type=&quot;text&quot; value=&quot;@generatedGuid&quot;/&gt;&lt;button type=&quot;button&quot; @onclick(Generate)&gt;Generate!&lt;/button&gt;

    @functions {

        string generatedGuid = string.Empty;

        private void Generate()
        {
            generatedGuid = Guid.NewGuid().ToString();
        }
    }
</code></pre>
<p>Evidemment, ici le code est extremement simple, mais dans la vraie vie j'vous le donne dans le mille on aurait envie de faire des tests unitaires de notre code C#.</p>
<p>Je vous propose donc cette facon de faire. On va créer un classe qui hérite de <strong>BlazorComponent</strong> et on y mettra notre code métier.</p>
<p>Commençons par créér une classe qui contiendra notre code behind</p>
<pre><code class="language-csharp">using System;
using Microsoft.AspNetCore.Blazor.Components;

namespace OwnBlazor.Pages
{
    public class GuidGenerator : BlazorComponent
    {
        public string GeneratedGuid { get; set; }

        public void Generate()
        {
            GeneratedGuid = Guid.NewGuid().ToString();
        }
    }
}
</code></pre>
<p>la seule chose qu'il faut noter ici, c'est que notre classe hérite de <strong>BlazorComponent</strong></p>
<p>Passons à notre vue qui est maintenant beaucoup plus propre.</p>
<pre><code class="language-csharp">@page &quot;/guid2&quot;
@inherits OwnBlazor.Pages.GuidGenerator

    &lt;h1&gt;Guid Generator&lt;/h1&gt;

    &lt;input type=&quot;text&quot; value=&quot;@GeneratedGuid&quot;/&gt;&lt;button type=&quot;button&quot; @onclick(Generate)&gt;Generate&lt;/button&gt;
</code></pre>
<p>Dans la vue on spécifiera que l'on hérite de notre classe <strong>GuidGenerator</strong> précédement créée.</p>
<p>Voila, c'est quand même un peu plus propre et surtout pn peut facilement tester notre code C#.</p>
</div>]]></content:encoded></item><item><title><![CDATA[Combiner des Expressions Trees]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Il y a tout juste quelques jours, on pair programmait avec <a href="https://fr.linkedin.com/in/hocquet">Anthony</a> sur un projet. Nous nous sommes retrouvés a vouloir combiner au runtime des <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/expression-trees/">Expressions trees</a> en fonction de parametres évalués au runtime.</p>
<p>En gros on avait envie d'écrire un truc du genre</p>
<pre><code class="language-csharp">Expression&lt;Func&lt;Person, bool&</code></pre></div>]]></description><link>http://www.mymemoryleaks.fr/combiner-des-expressions-trees/</link><guid isPermaLink="false">5ac3d3fab8151d4864f88e10</guid><category><![CDATA[C#]]></category><category><![CDATA[Expressions trees]]></category><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Tue, 03 Apr 2018 21:43:43 GMT</pubDate><media:content url="http://www.mymemoryleaks.fr/content/images/2018/04/tress.jpg" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="http://www.mymemoryleaks.fr/content/images/2018/04/tress.jpg" alt="Combiner des Expressions Trees"><p>Il y a tout juste quelques jours, on pair programmait avec <a href="https://fr.linkedin.com/in/hocquet">Anthony</a> sur un projet. Nous nous sommes retrouvés a vouloir combiner au runtime des <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/expression-trees/">Expressions trees</a> en fonction de parametres évalués au runtime.</p>
<p>En gros on avait envie d'écrire un truc du genre</p>
<pre><code class="language-csharp">Expression&lt;Func&lt;Person, bool&gt;&gt; predicate = x =&gt; x.Id &gt; 1;
</code></pre>
<p>puis un peu plus loin</p>
<pre><code class="language-csharp">predicate += x =&gt; x.Name.Length &lt; 6;
</code></pre>
<p>Ne cherchez pas à compiler ca, le compilo risque de se rebeller.</p>
<p>On était un peu pris par le temps, du coup on a fait un simple. Néanmoins je profite de cet espace pour partager avec vous une facon de faire pour combiner des Expressions et faire du code un peu plus <em>sexy</em></p>
<p>Pour faire plaisir à <a href="https://twitter.com/EjDel?lang=fr">maitre Etienne</a> on va travailler a base de tests unitaires.</p>
<p>Commençons par la version naïve; En cherchant un peu sur la msdn on tombera facilement sur <a href="https://msdn.microsoft.com/fr-fr/library/bb382914(v=vs.110).aspx">Expression.AndAlso</a> permettant de créer une nouvelle expression qui combine deux Expressions <em>left</em> et <em>right</em></p>
<pre><code class="language-csharp">        [Fact]
        public void SimpleCombining_Fails()
        {
            // Arrange
            Expression&lt;Func&lt;Person, bool&gt;&gt; firstPredicate = x =&gt; x.Id &gt; 1;
            Expression&lt;Func&lt;Person, bool&gt;&gt; secondPredicate = x =&gt; x.Name.Length &lt; 6;
            
            Expression binaryexp = Expression.AndAlso(firstPredicate.Body, secondPredicate.Body);
            ParameterExpression[] parameters = {
                Expression.Parameter(typeof(Person), firstPredicate.Parameters.First().Name)
            };
            
            Expression&lt;Func&lt;Person, bool&gt;&gt; lambda = Expression.Lambda&lt;Func&lt;Person, bool&gt;&gt;(binaryexp, parameters);
            
            // Act
            Action filter = () =&gt; {
                var combinedPredicate = lambda.Compile();
                var result = _persons.Where(combinedPredicate);
            };

            // Assert
            Assert.Throws&lt;InvalidOperationException&gt;(() =&gt; filter());
        }
</code></pre>
<p>On commence par définir nos deux prédicats (left &amp; right) que l'on combine dans une expression binaire AndAlso (et logique) en utilisant comme paramètre générique <em><strong>T</strong></em> le paramètre utilisé dans la premiere expression initiale.<br>
On essaye par la suite d'utiliser la lambda créée pour l'occasion dans une instruction <a href="https://msdn.microsoft.com/fr-fr/library/bb549418(v=vs.110).aspx">Where</a> que vous connaissez tous en Linq.</p>
<p>Bon, j'avais déjà vendu la méche en disant que c'était une version naïve; effectivement a l'execution vous allez avoir une <a href="https://msdn.microsoft.com/fr-fr/library/system.invalidoperationexception(v=vs.110).aspx">InvalidOperationException</a></p>
<pre><code class="language-xml">System.InvalidOperationException: 'variable 'x' of type 'AndOrExpressions.Person' referenced from scope '', but it is not defined'
</code></pre>
<p>Pour faire simple, dans nos deux expressions initiales, le paramètre <em>x</em> bien qu'il se nomme de la même maniere et soit du même type, il ne s'agit pas du meme objet. <em>x</em> est donc inconnu dans la seconde expression.</p>
<p>Etant donné que les Expressions sont des objets <a href="https://en.wikipedia.org/wiki/Immutable_object">immutables</a> il va nous falloir un moyen de créer/réécrire une expression donnée.</p>
<p>C'est pour ce genre de cas qu'MS a mis à notre disposition la classe <a href="https://msdn.microsoft.com/fr-fr/library/system.linq.expressions.expressionvisitor(v=vs.110).aspx">ExpressionVisitor</a>. Celle-ci  nous permet de traverser l'expression tree et d'apporter des modifications. Rappelez vous que chaque modification produira une nouvelle expression, c'est le principe même de l'immutabilité.</p>
<p>Ok, commencons par créer une visiteur qui remplacera un paramètre <em><strong>T</strong></em> par un autre passé en paramètre.</p>
<pre><code class="language-csharp">public class ReplaceExpressionVisitor : ExpressionVisitor
    {
        private readonly Expression _searched;
        private readonly Expression _replacement;

        public ReplaceExpressionVisitor(Expression searched, Expression replacement)
        {
            _searched = searched;
            _replacement = replacement;
        }

        public override Expression Visit(Expression node)
        {
            if (node == _searched)
            {
                return _replacement;
            }   
            return base.Visit(node);
        }
    }
</code></pre>
<p>Simple, non?</p>
<p>Du coup si on réécrivait notre test de la facon suivante en imaginant une methode And qui permet de combiner des Expressions</p>
<pre><code class="language-csharp">[Fact]
        public void ReplacingType_Succeed()
        {
            // Arrange
            Expression&lt;Func&lt;Person, bool&gt;&gt; firstPredicate = x =&gt; x.Id &gt; 1;
            Expression&lt;Func&lt;Person, bool&gt;&gt; secondPredicate = x =&gt; x.Name.Length &lt; 6;

            Func&lt;Person, bool&gt; combinedPredicate = firstPredicate.And(secondPredicate);
            
            // Act
            var result = _persons.Where(combinedPredicate);

            // Assert
            Assert.Collection(result, people =&gt; Assert.Equal(people, Anto));
        }
</code></pre>
<p>Il ne nous reste qu'à définir une methode d'extension qui répond a cette signature, comme ceci :</p>
<pre><code class="language-csharp">public static class ExpressionsExtensions
    {
        public static Func&lt;T, bool&gt; And&lt;T&gt;(this Expression&lt;Func&lt;T, bool&gt;&gt; firstOperand, Expression&lt;Func&lt;T, bool&gt;&gt; secondOperand)
        {
            var replacement = Expression.Parameter(typeof(T));

            var leftVisitor = new ReplaceExpressionVisitor(firstOperand.Parameters[0], replacement);
            var left = leftVisitor.Visit(firstOperand.Body);

            var rightVisitor = new ReplaceExpressionVisitor(secondOperand.Parameters[0], replacement);
            var right = rightVisitor.Visit(secondOperand.Body);

            return Expression.Lambda&lt;Func&lt;T, bool&gt;&gt;(Expression.AndAlso(left, right), replacement)
                             .Compile();
        }
    }
</code></pre>
<p>Cette methode va combiner avec <em>Expression.AndAlso</em> nos deux expressions initiales, mais cette fois ci on aura prit soin de les réécrire en utilisant le même paramètre générique. Et évidemment cette fois-ci, le test est vert :)</p>
</div>]]></content:encoded></item><item><title><![CDATA[J'recommence, je git mon blog!]]></title><description><![CDATA[J'ai passé 8 ans la-bas, sur blogger. Si je me souviens bien c'est Francois qui m'avais recommandé cette plateforme.]]></description><link>http://www.mymemoryleaks.fr/on-recommence-je-git-mon-blog/</link><guid isPermaLink="false">5ac27ad4a9a75b30c4d00a70</guid><category><![CDATA[git]]></category><category><![CDATA[blog]]></category><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Mon, 02 Apr 2018 20:20:21 GMT</pubDate><media:content url="http://www.mymemoryleaks.fr/content/images/2018/04/github-1.png" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="http://www.mymemoryleaks.fr/content/images/2018/04/github-1.png" alt="J'recommence, je git mon blog!"><p>J'ai passé 8 ans la-bas, sur <a href="http://mymemoryleaks.blogspot.fr/">blogger</a>. Si je me souviens bien c'est <a href="https://fjehl.wordpress.com/">Francois</a> qui m'avais recommandé cette plateforme. Puis le temps à passé, François comme beaucoup d'autres ont bougé vers d'autres horizons, <a href="https://fr.wordpress.org/">wordpress</a> par exemple.</p>
<p>Pas moi... un peu par flemme, faut bien le dire.</p>
<p>Parfois l'idée et l'envie de pondre un article est la, mais compliqué de le faire dans le train car faut etre connecté sur <a href="https://www.blogger.com/">blogger.com</a> pour pouvoir écrire. D'autres problématiques se font sentir, ou stocker les images/screenshots etc...</p>
<p>Bref, il etait temps de demenager. Mais pour aller ou?</p>
<p>J'en ai parlé à mes collègues chez mon <a href="https://www.younited-credit.com/">client actuel</a>. J'voulais un truc light, facile à heberger, avec lequel je pouvais travailler en mode déconnecté. On a parlé de <a href="https://ghost.org/fr/">Ghost</a>, de <a href="https://jekyllrb.com/">Jekyll</a>, et puis des modes d'hébergement. Et la ca a fait tilt quand <a href="https://fr.linkedin.com/in/hocquet">Anthony</a> m'a rappelé qu'il y avait les <a href="https://pages.github.com/">github pages</a>. En deux mots, un repository git qui est exposé comme un site web.<br>
Merci encore pour le brainstorming mon grand!</p>
<p>D'ailleurs dans un prochain billet, je détaillerai la solution technique derrière ce blog, et comment j'ai rapatrié tous les posts depuis mon ancienne plateforme.<br>
Ho, j'oubliais, <a href="https://pages.github.com/">github pages</a> est si smart que j'ai même pu investir dans un <a href="http://www.mymemoryleaks.fr/">nom de domaine</a> (deux en réalité) et l'affecter à ce repository git.</p>
<p>Me revoilà donc, sous une nouvelle forme visuelle mais comme avant, pour partager mes pérégrinations autours des technos <a href="https://www.microsoft.com">Microsoft</a>.</p>
</div>]]></content:encoded></item><item><title><![CDATA[Déployer un webjob avec VSTS]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Si vous avez déjà eu besoin de déployer un <a href="https://docs.microsoft.com/fr-fr/azure/app-service/web-sites-create-web-jobs">azure webjob</a> via vsts, vous avez du tomber sur ce <a href="https://medium.com/@thomashellstrom/building-azure-webjobs-in-vsts-4306e141df49">bon blog post de Thomas Hellstrøm</a>. Néanmoins, en suivant telles quelles les instructions de notre ami Thomas, vous risquer de casser la webapp qui host votre webjob.</p>
<p>Ce blog post va</p></div>]]></description><link>http://www.mymemoryleaks.fr/deployer-un-webjob-avec-vsts/</link><guid isPermaLink="false">5a99b626f336bf15fc91af81</guid><category><![CDATA[VSTS]]></category><category><![CDATA[WebJob]]></category><category><![CDATA[Azure]]></category><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Fri, 09 Feb 2018 22:52:00 GMT</pubDate><content:encoded><![CDATA[<div class="kg-card-markdown"><p>Si vous avez déjà eu besoin de déployer un <a href="https://docs.microsoft.com/fr-fr/azure/app-service/web-sites-create-web-jobs">azure webjob</a> via vsts, vous avez du tomber sur ce <a href="https://medium.com/@thomashellstrom/building-azure-webjobs-in-vsts-4306e141df49">bon blog post de Thomas Hellstrøm</a>. Néanmoins, en suivant telles quelles les instructions de notre ami Thomas, vous risquer de casser la webapp qui host votre webjob.</p>
<p>Ce blog post va prendre la tournure d’une recette de cuisine, d’un pense bête ; cela m’évitera de me reposer la même question dans quelques mois, et j'espère secrètement que cela puisse aider certains d'entre vous.</p>
<p>On commence donc par utiliser la fonction « Publish as Azure Webjob » à partir de Visual Studio 2017.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=1oxmVOgeleLcE0HoiBmqXgw4NdZPzV1f6" alt=""></p>
<p>Pas la peine d’aller au bout du deploy, ce tool va ajouter le package nuget <a href="https://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/">Microsoft.Web.WebJobs.Publish</a> et créer le fichier « webjob-publish-settinps.json » dans le répertoire properties de votre projet.</p>
<p>On passe ensuite sur le build sur VSTS. Thomas nous propose de définir les arguments suivants sur la tache msbuild :</p>
<pre><code class="language-ps1">/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:Configuration=Release
</code></pre>
<p>Notez le paramètre « /p:WebPublishMethod=Package », qui produira un fichier zip.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=1Y9grjF4l84j-rI2G-7wRxUalCeD3h2cJ" alt=""></p>
<p>Et en jetant un œil dans le fichier zip, mauvaise surprise, on est en train de packager le dossier bin avec des dll qui vont venir écraser celles qui appartiennent à la webapp.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=13Jx4y2OZzK3HOhF9C1Bnl7yMs6fs_-DQ" alt=""></p>
<p>Du coup j’vous propose de corriger ça.<br>
On commence par changer les arguments de la tache msbuild.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=1-t4EzYGYxTRwzM5iLDSSJzQSPEUDRs3L" alt=""></p>
<pre><code class="language-ps1">/p:DeployOnBuild=true /p:WebPublishMethod=FileSystem /p:publishUrl=&quot;$(build.artifactstagingdirectory)&quot; /p:DeployDefaultTarget=WebPublish
</code></pre>
<p>Ce qui va produire le même contenu que le fichier zip mais directement sur le système de fichier.</p>
<p>Puis on ajoute une tache delete file, qui se chargera de supprimer le dossier /bin que nous voulons éviter de déployer.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=13y7Jd2gEmFBlOKOeAr2EVsypWOf63FTZ" alt=""></p>
<p>Voila, cette fois ci nous y sommes. J’espère que cela pourra vous aider!</p>
</div>]]></content:encoded></item><item><title><![CDATA[VSTS – Quand y’a plus de crédits, y’en a encore.]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Ça, c’est la poisse: <code>Your account has no free minutes remaining</code>.</p>
<p>Le scénario est à se pendre, tu montes ton projet en intégration continue et après quelques (dizaines) de commit tu te retrouves dans l’impossibilité de complétera une PR ou juste vérifier que le dernier commit n’a</p></div>]]></description><link>http://www.mymemoryleaks.fr/vsts-quand-ya-plus-de-credits-yen-a-encore/</link><guid isPermaLink="false">5a99b626f336bf15fc91af80</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Mon, 29 Jan 2018 23:14:00 GMT</pubDate><content:encoded><![CDATA[<div class="kg-card-markdown"><p>Ça, c’est la poisse: <code>Your account has no free minutes remaining</code>.</p>
<p>Le scénario est à se pendre, tu montes ton projet en intégration continue et après quelques (dizaines) de commit tu te retrouves dans l’impossibilité de complétera une PR ou juste vérifier que le dernier commit n’a pas introduit de régressions.</p>
<p>Du coup je me propose de présenter ici, comment créer à moindre frais un agent de build sur-vitaminé. Et le fait d’avoir une machine un peu costaud, n’est pas un moindre mal ; qui ne s’est pas arraché les cheveux en attendant que l’agent de build hosté veuille bien se lancer et faire son travail… ?</p>
<p>Plutôt que de créer nous même une vm, installer windows, msbuild et tout le nécessaire a un agent de build, on va plutôt utiliser azure <a href="https://azure.microsoft.com/fr-fr/services/devtest-lab/">DevTest Lab</a>. L’idée est de tirer parti des template de vm qui sont mises a notre dispo.</p>
<p>Après avoir créé votre première instance DevTest lab, on ajoute une vm basée sur l’image Visual Studio Community 2017 (latest release) on Windows Server 2016 (x64).</p>
<p><a href="https://drive.google.com/uc?export=download&amp;id=1yq-8OdL7oeffvZ-lsW8Ll01dy0n6g8KQ"><img src="https://drive.google.com/uc?export=download&amp;id=1yq-8OdL7oeffvZ-lsW8Ll01dy0n6g8KQ" alt=""></a></p>
<p>On va vous demander un login et un mot de passe pour le compte admin de la future vm.<br>
Je vous conseille de stocker votre mot de passe dans le coffre-fort « my secret » pour une plus grande sécurité. (ce n’est donc pas mon mot de passe que vous voyez 😊)</p>
<p>Bon il nous faut maintenant choisir les caractéristiques de la vm. J’ai opté pour 32 GO de ram et 8 vcpu, une D8S_V3, elle ne sera allumée que quelques minutes le temps de faire le build, donc elle ne nous coutera pas bien cher.</p>
<p>Place aux artefacts, il convient de voir cela comme des scripts additionnels qui installeront d’autres programmes/services sur votre vm. Ça tombe bien, l’artefact VSTS Build agent nous procure le service de build qui convient.</p>
<p><a href="https://drive.google.com/uc?export=download&amp;id=1uhrvXnuNP5G6U7X66SdH3tj7XSmK380K"><img src="https://drive.google.com/uc?export=download&amp;id=1uhrvXnuNP5G6U7X66SdH3tj7XSmK380K" alt=""></a></p>
<p>Quelques précisions, le champs VSTS account name doit se conformer au pattern suivant : <code>https://{{vsts_account_name}}.visualstudio.com</code></p>
<p>Le secret correspond une clé privée que vous pourrez crée en vous rendant à l’adresse <code>https://{{vsts_account_name}}.visualstudio.com/_details/security/tokens</code></p>
<p>Finalement, l’agent pool doit être un pool pré-existant. A vérifier/créer ici : <code>https://{{vsts_account_name}}.visualstudio.com/_admin/_AgentPool</code></p>
<p>Petit plus, dans le cas ou vous envisagez de builder des projets front, profitez de cette étape pour ajouter l’artefact NODE JS.</p>
<p>Bon, aller y’a plus qu’a cliquer sur OK, attendre quelques minutes et l’agent devrait apparaitre dans le pool que vous avez choisi.</p>
<p><a href="https://drive.google.com/uc?export=download&amp;id=1fLWtBjZ32fLL-ilmRq1GqPr3-dm8DK3j"><img src="https://drive.google.com/uc?export=download&amp;id=1fLWtBjZ32fLL-ilmRq1GqPr3-dm8DK3j" alt=""></a></p>
<p>Quoi qu’il en soit pas de panique, si vous vous êtes trompé sur un paramètre des artefacts, il sera toujours possible de retenter l’installation a postériori ou bien de procéder a l’installation manuellement.</p>
<p>Dernier point, si vos crédits azure ne vous permettent pas de laisser cette vm allumée tout le temps, voici deux petites commandes qui vous permettront d’allumer et d’éteindre la vm a volonté. (a utiliser dans une console <a href="https://docs.microsoft.com/fr-fr/cli/azure/install-azure-cli?view=azure-cli-latest">azure cli</a></p>
<pre><code class="language-ps1">az lab vm {{command}} --lab-name {{devtestlab}} --name {{vm-name}} --resource-group {{resource-group}}
</code></pre>
<p>command : start ou stop<br>
devtestlab : le nom de votre instance DevTest lab<br>
vm-name : le nom de votre vm<br>
resource-group : le nom du resource group ou est installé la vm.</p>
</div>]]></content:encoded></item><item><title><![CDATA[OData & ngTable : un duo de choc]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Dernièrement, j’ai pas mal fait joujou avec <a href="http://www.odata.org/documentation/">OData</a>.<br>
C’est quand même super plaisant de pouvoir requêter une source de données via une URL et avec une richesse proche de ce que l’on connait avec du SQL.<br>
Une fois n’est pas coutume je ne vais pas parler</p></div>]]></description><link>http://www.mymemoryleaks.fr/odata-ngtable-un-duo-de-choc/</link><guid isPermaLink="false">5a99b626f336bf15fc91af7f</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Mon, 12 Dec 2016 11:46:00 GMT</pubDate><content:encoded><![CDATA[<div class="kg-card-markdown"><p>Dernièrement, j’ai pas mal fait joujou avec <a href="http://www.odata.org/documentation/">OData</a>.<br>
C’est quand même super plaisant de pouvoir requêter une source de données via une URL et avec une richesse proche de ce que l’on connait avec du SQL.<br>
Une fois n’est pas coutume je ne vais pas parler de .NET mais plutôt partager avec vous un bout de javascript qui met en évidence la facilité avec laquelle vous pourrez brancher des tables <a href="http://ng-table.com/">ngtable</a> avec votre backend odata.</p>
<p>Trêve de bavardage, on passe au code :</p>
<iframe width="100%" height="1000" src="//jsfiddle.net/mymemoryleaks/r5hfj5b2/12/embedded/js,html,css,result/dark/" allowpaymentrequest="" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
<p>Pour cette illustration, j'ai utilisé le web service <a href="http://services.odata.org/">services.odata.org</a> qui expose la base Northwind (sample Microsoft) que l'on a tous croisés un jour.</p>
<p>Juste un mot sur le code, évidemment c'est le service odataTableService qui fait la glue entre OData et ngTable; c'est lui qui permet de réaliser les filtrages et les sorts. Une fois que ce service est disponible dans votre app, regardez avec quelle simplicité, votre controller peut créer une table :</p>
<pre><code class="language-js">$scope.tableParams = odataTableService.createTableParams({ endPoint: 'http://services.odata.org/V3/Northwind/Northwind.svc/Products' });
</code></pre>
<p>Je me demande vraiment pourquoi OData n'a pas plus que ça le vent en poupe.</p>
</div>]]></content:encoded></item><item><title><![CDATA[Packager un projet SQL pour Octopus]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Que ce soit manuellement ou de manière automatique, lorsque l'on parle de déploiement il va nous falloir définir un package de déploiement.</p>
<p>Dans l'univers Octopus, les packages de déploiement sont des fichiers avec une extension .nupkg. Voyons comment en créer un pour un projet de Base de données.</p>
<h2 id="ajouterunedpendanceversoctopack">Ajouter une</h2></div>]]></description><link>http://www.mymemoryleaks.fr/packager-un-projet-sql-pour-octopus/</link><guid isPermaLink="false">5a99b626f336bf15fc91af7e</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Thu, 01 Sep 2016 20:07:00 GMT</pubDate><content:encoded><![CDATA[<div class="kg-card-markdown"><p>Que ce soit manuellement ou de manière automatique, lorsque l'on parle de déploiement il va nous falloir définir un package de déploiement.</p>
<p>Dans l'univers Octopus, les packages de déploiement sont des fichiers avec une extension .nupkg. Voyons comment en créer un pour un projet de Base de données.</p>
<h2 id="ajouterunedpendanceversoctopack">Ajouter une dépendance vers Octopack</h2>
<p><a href="https://github.com/OctopusDeploy/OctoPack">Octopack</a> est l’utilitaire que nous allons utiliser pour générer ce package de déploiement. Démystifions le terme, octopack produit un fichier qui n’est autre qu’un zip, contenant les fichiers à déployer ainsi qu’un ensemble de métadonnées et potentiellement des scripts powershell.<br>
Bref, rien de bien extraordinaire.</p>
<p>Pour l’installer dans notre projet de base de données, nous allons utiliser Nuget, qui est un gestionnaire de dépendances très performant et bien connu des développeurs. Cependant il n’est pas facilement accessible lorsqu’on travailler sur un projet SQL/SSIS/SSRS/SSAS.</p>
<p>Pour tromper Visual Studio nous allons commencer par ajouter un projet C# de type console pour faire simple</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhX2MtUFgtaWkzSnc" alt=""></p>
<p>Ajoutons sur ce projet C# une dépendance vers Octopack.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhWW5GRURBWXZOaGc" alt=""></p>
<p>Dans la nouvelle fenêtre on cherche le package Octopack, et on l’installe.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhYTBIVkZQenpZWkU" alt=""></p>
<p>Après avoir acquitté la fenêtre de preview d’install, la fenêtre «Output» de visual Studio devrait vous confirmer que l’installation s’est bien passée.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhNVVFYnBwZEs1bmc" alt=""></p>
<p>Il aurait été formidable de pouvoir l’installer directement dans notre projet de base, mais nous allons devoir transpirer un peu plus pour arriver à nos fins.<br>
Ready ?? Ouvrons le fichier csproj de l’application console et copions la portion de msbuild qui correspond à Octopack</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhT0RybERZZi1hWnc" alt=""></p>
<p>Puis, copions la discrètement dans notre fichier sqlproj, de la même manière à la fin de celui-ci.<br>
Un petit rebuild pour vérifier que tout fonctionne toujours bien… et TADAM y’a toujours pas de package de déploiement généré.</p>
<h2 id="crerlepackage">Créer le package</h2>
<p>Bon si vous avez été un peu curieux, vous aurez remarqué que la portion de msbuild que l’on a copiée a pour but d’importer un autre fichier msbuild (qui se trouve dans le répertoire packagesOctoPack.3.4.1toolsOctoPack.targets)</p>
<p>En baragouinant un peu le msbuild, on comprend assez vite que la variable <code>RunOctoPack</code> est initialisée à <code>false et c’est elle qui déclenche ou non la génération du package.</code></p>
<p>Alors évidemment, une solution possible est de modifier cette variable à true. Néanmoins cela induit qu’un package de déploiement sera créé a chaque build du projet. Ce n’est vraisemblablement pas ce que vous souhaitez.</p>
<p>Je vous propose plutôt d’ouvrir une console DOS et une fois dans le répertoire du projet, tapez la commande suivante :</p>
<p>msbuild ContinuousBI.Sql.sqlproj /t:Build /p:RunOctoPack=true</p>
<p>Si tout s’est bien passé vous devriez avoir une sortie similaire a celle-ci :</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhVUh0aGctS2RJb0k" alt=""></p>
<p>Cette fois ci, si vous jetez un œil dans le sous-dossier obj/octopacked de votre projet vous y découvrirez un fichier .nupkg qui est le package de déploiement</p>
<h2 id="aquoiressemblemonpackage">A quoi ressemble mon package ?</h2>
<p>Pour aller un peu plus loin nous pouvons jeter un œil à ce qui a été produit pour nous par Octopack.<br>
Je vous propose d’utiliser <a href="https://npe.codeplex.com/downloads/get/clickOnce/NuGetPackageExplorer.application">nuget package explorer</a><br>
Ouvrez le et glissez déposez le fichier .nupkg, vous devriez obtenir un résultat semblable à celui-ci.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhTTFubGpDVU9wa3M" alt=""></p>
<p>C’est confirmé, le dacpac issu de la compilation à bien été reconnu ; il est embarqué dans package de déploiement.</p>
<p>Nous verrons dans le prochain post comment le déployer avec Octopus.</p>
</div>]]></content:encoded></item><item><title><![CDATA[Prolific usb to ttl et windows 10]]></title><description><![CDATA[<div class="kg-card-markdown"><p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhdWZ0NHAxcGRMalk" alt=""></p>
<p>Dernièrement j'ai ressorti ma <a href="https://beagleboard.org/black">BeableBone Black</a> histoire de faire une peu de veille techno. J'vous raconterai un de ces quatre en quoi monter une boite peut vite cramer tout votre temps libre, mais c'est pour la bonne cause.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhR3hTSnd4Z0FXNGM" alt=""></p>
<p>Bref pour en revenir à la Beagle, je ressors mon câble série</p></div>]]></description><link>http://www.mymemoryleaks.fr/prolific-usb-to-ttl-et-windows-10/</link><guid isPermaLink="false">5a99b626f336bf15fc91af7d</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Wed, 11 May 2016 21:34:00 GMT</pubDate><content:encoded><![CDATA[<div class="kg-card-markdown"><p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhdWZ0NHAxcGRMalk" alt=""></p>
<p>Dernièrement j'ai ressorti ma <a href="https://beagleboard.org/black">BeableBone Black</a> histoire de faire une peu de veille techno. J'vous raconterai un de ces quatre en quoi monter une boite peut vite cramer tout votre temps libre, mais c'est pour la bonne cause.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhR3hTSnd4Z0FXNGM" alt=""></p>
<p>Bref pour en revenir à la Beagle, je ressors mon câble série que j'utilise pour me connecter à la console. Je fais les branchements et go sur le site de <a href="http://www.prolific.com.tw/US/ShowProduct.aspx?p_id=225&amp;pcid=41">Prolific</a> pour récupérer le dernier driver pour Windows 10.</p>
<p>Tiens! bizarre, même après un reboot je n'ai toujours rien qui s'affiche dans mon terminal.<br>
En creusant, je m'aperçois que le driver du câble n'est pas reconnu.</p>
<p><img src="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhWTJhdmlPLTE0Q0k" alt=""></p>
<p>S'en suit plusieurs tentatives de réinstallation et de reboot infructueuses.</p>
<p>Je cherche un peu sur Internet, pas mal de personnes ont des soucis avec des versions contrefaites acheté sur des sites asiatiques. Le mien vient de chez <a href="https://www.adafruit.com/product/954">Adafruit</a>, et il fonctionnait parfaitement il y a quelques mois, sur Windows 8.</p>
<p>Ho... tiens réessayons sur cet ancien PC. Ca fonctionne parfaitement!<br>
Énorme je récupère l'installer du driver qui se trouve sur ce dernier;<br>
Je repasse sur mon PC équipé de Windows 10, désinstalle le driver en place, reboot, installe l'ancien driver (fonctionnant sur Windows 8) et surprise, ca fonctionne.</p>
<p>Si ça c'est pas de l'obsolescence programmée! Honteux!<br>
Rien que pour ça, je vous recommande plutôt d'investir dans un câble concurrent comme ce <a href="https://www.adafruit.com/products/70">FTDI</a>. J'en possède un également et fonctionne tout aussi bien.</p>
<p>Du coup, je vous dépose le driver fonctionnel, <a href="https://drive.google.com/uc?export=download&amp;id=0B3FYDprTEqfhanJlSTBZY3ZnZnc">ici</a>. J'espères que cela pourra aider quelqu'un.</p>
<p>Tiens, en prime je poste ici le schéma de branchement du câble Prolific avec la beagle.</p>
<ul>
<li>Le fil noir va sur le pin 1 (GND)</li>
<li>le fil vert sur le pin 4 (RECEIVE)</li>
<li>le fil blanc sur le pin 5 (TRANSMIT)</li>
</ul>
<p>Ne branchez surtout pas le fil rouge, c'est du 5V, vous grilleriez la beagle!!</p>
</div>]]></content:encoded></item><item><title><![CDATA[Comment invoquer une méthode dont on connait le nom à l’exécution sur un dynamic?]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Comment invoquer une méthode dont on connait le nom à l'exécution sur un dynamic?</p>
<p>Le mot clé dynamic en C# n'est pas nouveau, il a vu le jour avec C# 4 et pourtant il n’apparaît pas si souvent que ça dans les bouts de code que je fréquente.</p>
<p>Dernièrement</p></div>]]></description><link>http://www.mymemoryleaks.fr/comment-invoquer-une-methode-dont-on-connait-le-nom-a-lexecution-sur-un-dynamic/</link><guid isPermaLink="false">5a99b626f336bf15fc91af78</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Fri, 24 Jul 2015 12:51:00 GMT</pubDate><content:encoded><![CDATA[<div class="kg-card-markdown"><p>Comment invoquer une méthode dont on connait le nom à l'exécution sur un dynamic?</p>
<p>Le mot clé dynamic en C# n'est pas nouveau, il a vu le jour avec C# 4 et pourtant il n’apparaît pas si souvent que ça dans les bouts de code que je fréquente.</p>
<p>Dernièrement je l'ai recroisé en utilisant <a href="http://signalr.net/">SignalR</a>; les hubs qui sont générés sont des objets dynamic.</p>
<p>Quoi qu'il en soit, dernièrement j'ai eu besoin d'invoquer une méthode dont le nom ne m'était connu qu'à l'exécution.<br>
Croyez-moi, j'y ai passé un petit moment avant d'y arriver... Cela révèle vraisemblablement ma grande ignorance 🙂</p>
<p>Ce blog post prendra donc la forme d'un post-it qui me fera gagner du temps la prochaine fois que je me frotterai a cette bête-là. Si pour vous les classes <a href="https://msdn.microsoft.com/fr-fr/library/microsoft.csharp.runtimebinder(v=vs.110).aspx">Binder</a> et <a href="https://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.callsite(v=vs.110).aspx">CallSite</a> n'ont plus de secret ce blog post vous semblera vraisemblablement bien terne.</p>
<p>Posons le problème, on me donne un objet dynamic auquel une méthode est ajoutée à l'exécution</p>
<p>private string sentence = &quot;Hello world&quot;; public dynamic BuildObj() { dynamic myDynObj = new ExpandoObject(); myDynObj.SayHello = new Func<string>(() =&gt; sentence); return myDynObj; }</string></p>
<p>Si j'avais connaissance de la méthode lors de la compilation je pourrais l'appeler ainsi :</p>
<p>[Test] public void CallDirectlyMethod() { dynamic myObj = BuildObj(); var ret = myObj.SayHello(); Assert.That(ret, Is.EqualTo(sentence)); }</p>
<p>Malheureusement la signature de la méthode ne m'est connue qu'à l'exécution.<br>
Ok, premier réflexe je sors l'attirail de la reflection.... mais les résultats restent catastrophiques :</p>
<p>[Test] public void CallMethodWithReflectionFails() { dynamic myObj = BuildObj(); Type t = myObj.GetType(); var method = t.GetMethod(&quot;SayHello&quot;, BindingFlags.Default | BindingFlags.Instance | BindingFlags.InvokeMethod | BindingFlags.NonPublic); Assert.That(method, Is.Null); }</p>
<p>Quels que soient les bindings flags, impossible de trouver la méthode... FAIL!!</p>
<p>Voici, donc la combinaison magique, un savant mélange de Runtime.Binder et CallSite...</p>
<p>[Test] public void CallMethodWithCallSite() { dynamic myObj = BuildObj(); var callSiteBinder = Binder.InvokeMember(CSharpBinderFlags.None, &quot;SayHello&quot;, Enumerable.Empty<type>(), myObj.GetType(), new [] { CSharpArgumentInfo.Create(CSharpArgumentInfoFlags.None, null) }); var callSite = CallSite&lt;Func&lt;CallSite, object, object&gt;&gt;.Create(callSiteBinder); string ret = callSite.Target(callSite, myObj); Assert.That(ret, Is.EqualTo(sentence)); }</type></p>
<p>Ok, essayons de décrypter un peu ce code qui semble un peu alambiqué.<br>
Binder.InvokeMember va nous permettre à l'exécution de pointer la bonne méthode un peu comme le ferait typeof(myObj).GetMethod()<br>
Le premier paramètre permet de spécifier la manière dont est traité le type de retour. Dans le cas d'une Action nous aurions pu utiliser CSharpBinderFlags.ResultDiscarded. Dans notre cas, une Func, CSharpBinderFlags.None fonctionne bien.</p>
<p>puis viens en seconde position, évidement le nom de la méthode a appelé, passée sous forme de chaine.</p>
<p>En troisième position, il conviendra de fournir la liste des arguments de types à nécessaire dans le cas d'une méthode générique.</p>
<p>Viens ensuite le type sur lequel effectuer l'invocation, ce qui permet de pointer une surcharge.</p>
<p>Et finalement les informations sur les paramètres attendus et le type de retour (le premier élément du tableau);</p>
<p>La création du CallSite&lt;Func&lt;CallSite, object, object&gt;&gt; permet d'arrêter la signature du delegate que l'on cherche à appeler. Notez, que le dernier argument générique &quot;object&quot; devrait etre &quot;string&quot;, car il représente le type de retour de la func... mais pour une raison qui m'échappe l'utilisation de string comme type de retour entraîne une erreur au runtime, alors que le retour de la func est bien affecté à une variable string à la ligne du dessous... il faut bien garder un peu de magie 🙂</p>
<p>Ok, évidemment il ne nous reste plus qu'à effectuer l'invocation, ce qui est réalisé via le code callSite.Target(callSite, myObj);</p>
<p>J'espère que ce post évitera quelques cheveux blancs a ceux qui se trouveront confronté au problème.</p>
</div>]]></content:encoded></item><item><title><![CDATA[BeagleBone Black du carton à Mono]]></title><description><![CDATA[<div class="kg-card-markdown"><p><a href="http://beagleboard.org/BLACK">L’IOT</a>, on en parle partout, de plus en plus ; évidemment l’univers Microsoft n’est pas en retrait sur ce domaine avec la mise à disposition de Windows 10 sur le <a href="https://msdn.microsoft.com/fr-fr/Library/Windows/Hardware/dn914597.aspx?f=255&amp;MSPPError=-2147217396#raspberry_pi_2">Raspberry</a> ou encore le <a href="https://msdn.microsoft.com/fr-fr/Library/Windows/Hardware/dn914597.aspx?f=255&amp;MSPPError=-2147217396#minnowboard_max">MinnowBoard MAX</a></p>
<p>Vous trouverez pas mal de blog post autour du raspberry… je vais</p></div>]]></description><link>http://www.mymemoryleaks.fr/beaglebone-black-du-carton-a-mono/</link><guid isPermaLink="false">5a99b626f336bf15fc91af77</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Mon, 01 Jun 2015 10:31:00 GMT</pubDate><media:content url="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/bbb_overview.png" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/bbb_overview.png" alt="BeagleBone Black du carton à Mono"><p><a href="http://beagleboard.org/BLACK">L’IOT</a>, on en parle partout, de plus en plus ; évidemment l’univers Microsoft n’est pas en retrait sur ce domaine avec la mise à disposition de Windows 10 sur le <a href="https://msdn.microsoft.com/fr-fr/Library/Windows/Hardware/dn914597.aspx?f=255&amp;MSPPError=-2147217396#raspberry_pi_2">Raspberry</a> ou encore le <a href="https://msdn.microsoft.com/fr-fr/Library/Windows/Hardware/dn914597.aspx?f=255&amp;MSPPError=-2147217396#minnowboard_max">MinnowBoard MAX</a></p>
<p>Vous trouverez pas mal de blog post autour du raspberry… je vais donc plutôt vous présenter comment vous lancer dans le développement .NET embarqu&amp; sur cette magnifique plateforme qu’est le <a href="http://beagleboard.org/BLACK">BeagleBone Black (BBB)</a>. Au travers de cet article je vous propose d’étudier les différentes étapes à réaliser pour pouvoir lancer votre premier « Hello World » embarqué.</p>
<p><a href="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/bbb_overview.png"><img src="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/bbb_overview-300x208.png" alt="BeagleBone Black du carton à Mono"></a></p>
<p>Tout d’abord il n’y a pas de Windows 10 sur le BBB, en tout cas pour l’instant, mais très honnêtement l’installation d’Ubuntu que je vous propose est à la portée de tous.</p>
<h1 id="matrielncessaire">Matériel nécessaire</h1>
<p>Je commence par un petit coup de pub pour le site <a href="https://www.adafruit.com/"> AdaFruit</a> ou vous trouverez tout le matos que vous pouvez imaginer pour nos petits joujoux.</p>
<p>Aller Go ! Pour faciliter la visualisation de ce qui se passe sur votre BBB je vous conseille d’investir dans un câble <a href="https://www.adafruit.com/products/70">Serial TTL-232 en usb</a>. Sans celui-ci vous devrez attendre que le BeagleBone ai récupéré une IP et vous y connecter (en ssh par exemple) et interagir avec.</p>
<p>Pour brancher le câble prenez comme repère le fil noir qui doit venir se placer sur le pin J1 de votre BBB.</p>
<p>Installez les drivers FTDI pour prendre en compte l’adaptateur usb. Ils se trouvent <a href="http://www.ftdichip.com/Drivers/VCP.htm">ici</a></p>
<p>Finalement en utilisant <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">Putty</a>, configuré comme ci-dessous la console s’affiche enfin sur votre pc.</p>
<p><a href="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/putty.png"><img src="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/putty-300x267.png" alt="BeagleBone Black du carton à Mono"></a></p>
<p>Si l’idée de brancher un câble Ethernet sur votre BeagleBone vous donne de l’urticaire, je vous conseille ce <a href="https://www.adafruit.com/products/70">dongle usb</a>. Il est directement reconnu sous Ubuntu.</p>
<h1 id="installationdubuntu">Installation d’Ubuntu</h1>
<p><a href="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/ubuntu.png"><img src="http://mah1979.qsandbox.com/wp-content/uploads/2015/06/ubuntu-300x212.png" alt="BeagleBone Black du carton à Mono"></a></p>
<p>Nous allons installer dans la mémoire eMMC la version 14.04 d’Ubuntu spécialement conçue pour la BBC. Après avoir <a href="https://rcn-ee.com/rootfs/2015-05-08/flasher/BBB-eMMC-flasher-ubuntu-14.04.2-console-armhf-2015-05-08-2gb.img.xz">téléchargé</a> le fichier img.xz, il vous faudra le décompresser avec un outil comme <a href="http://www.7-zip.org/">7zip</a>.</p>
<p>L’image ainsi extraite pourra être copiée sur une micro sd avec <a href="http://sourceforge.net/projects/win32diskimager/files/latest/download">Win 32 Disk Imager</a></p>
<p>Lorsque la copie se termine, insérer la micro sd dans le port prévu à cet effet sur la BBB. Tout en appuyant avec votre index sur le bouton « boot » (le plus proche du port Ethernet), alimentez la BeagleBone. Laissez le doigt appuyé jusqu’à ce que les diodes clignotent.</p>
<p>Il faut 5 bonnes minutes pour que l’installation se termine ; mais grâce au câble TTL vous serez aux premières loges pour suivre l’installation.</p>
<h1 id="misejourdusystmeetinstallationdemono">Mise à jour du Système et installation de mono</h1>
<p>Ok, si vous en êtes arrivé là, c’est du tout cuit.</p>
<p>Nous allons commencer par mettre à jour le système grâce package manager <a href="https://wiki.debian.org/Apt">APT</a>. A partir de la console tapez les commandes suivantes :</p>
<p>sudo apt-get update sudo apt-get upgrade</p>
<p>Après quelques minutes le système est prêt, on peut passer à Mono. Le runtime devrait être suffisant étant donné que l’on va se contenter d’exécuter des binaires créer sur votre machine de dev. Pour l’installation on tape donc :</p>
<p>sudo apt-get install mono-runtime</p>
<h1 id="crationdelexcutableetdploiementsurlebbb">Création de l’exécutable et déploiement sur le BBB</h1>
<p>Je vous laisse écrire votre premier Hello Beagle World dans Visual Studio ; en créant un projet de type console et en targettant le Framework 4.5;</p>
<p>Une fois compilé, j’ai opté pour un déploiement type « bin-deploy » en utilisant un transfert via <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PSCP</a></p>
<p>Une fois PSCP copié, vous pourriez copier le fichier avec une ligne de commande comme celle-ci :</p>
<p>pscp.exe &quot;C: BBB HelloWorldbinDebugHelloWorld.exe&quot; <a href="mailto:ubuntu@192.168.10.2">ubuntu@192.168.10.2</a>:/home/ubuntu</p>
<p>Le premier paramètre étant le ficher à transmettre le second l’url de destination au format :</p>
<p>user@hote:/chemin_de_destination</p>
<p>En dessert, après tous ces efforts, nous pouvons enfin exécuter sur le Beagle notre Hello World en tapant :</p>
<p>Mono HelloWorld.exe</p>
</div>]]></content:encoded></item><item><title><![CDATA[Kibana : Explorez vos données.]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Cet article fait partie d’une sérié dédiée à <a href="http://www.elasticsearch.org/">Elasticsearch</a>, reportez vous à <a href="http://mah1979.qsandbox.com/serie-elasticsearch/">l’article sommaire</a> pour accéder facilement aux autres posts.</p>
<p><a href="http://www.elasticsearch.org/overview/kibana/">Kibana</a> est la brique de visualisation qui gravite autour d’Elasticsearch. Voici, quelques exemple de représentations faites avec Kibana :</p>
<p><a href="http://2.bp.blogspot.com/-4kq3k0UkJlg/VJL7YBWhIwI/AAAAAAAAJB0/9JVdU2Iiqs8/s1600/kibana1.png" title="1"><br>
<img src="http://2.bp.blogspot.com/-4kq3k0UkJlg/VJL7YBWhIwI/AAAAAAAAJB0/9JVdU2Iiqs8/s1600/kibana1.png" alt=""><br>
</a><br>
<a href="http://4.bp.blogspot.com/-bhF7rAOdIWk/VJL7YDyzhLI/AAAAAAAAJB4/rkHhggrLNrs/s1600/kibana2.png" title="2"><br>
<img src="http://4.bp.blogspot.com/-bhF7rAOdIWk/VJL7YDyzhLI/AAAAAAAAJB4/rkHhggrLNrs/s1600/kibana2.png" alt="Kibana 2"><br>
</a><br>
<a href="http://1.bp.blogspot.com/-n8gAeiLX1ys/VJL7YBl092I/AAAAAAAAJCA/SodVO4jCNeI/s1600/kibana3.png" title="3"><br>
<img src="http://1.bp.blogspot.com/-n8gAeiLX1ys/VJL7YBl092I/AAAAAAAAJCA/SodVO4jCNeI/s1600/kibana3.png" alt="Kibana 3"><br>
</a></p>
<p>L’exploration de données et la réalisation de dashboard</p></div>]]></description><link>http://www.mymemoryleaks.fr/kibana-explorez-vos-donnees/</link><guid isPermaLink="false">5a99b626f336bf15fc91af76</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Tue, 23 Dec 2014 09:39:00 GMT</pubDate><media:content url="http://mah1979.qsandbox.com/wp-content/uploads/2014/12/kibana1.png" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="http://mah1979.qsandbox.com/wp-content/uploads/2014/12/kibana1.png" alt="Kibana : Explorez vos données."><p>Cet article fait partie d’une sérié dédiée à <a href="http://www.elasticsearch.org/">Elasticsearch</a>, reportez vous à <a href="http://mah1979.qsandbox.com/serie-elasticsearch/">l’article sommaire</a> pour accéder facilement aux autres posts.</p>
<p><a href="http://www.elasticsearch.org/overview/kibana/">Kibana</a> est la brique de visualisation qui gravite autour d’Elasticsearch. Voici, quelques exemple de représentations faites avec Kibana :</p>
<p><a href="http://2.bp.blogspot.com/-4kq3k0UkJlg/VJL7YBWhIwI/AAAAAAAAJB0/9JVdU2Iiqs8/s1600/kibana1.png" title="1"><br>
<img src="http://2.bp.blogspot.com/-4kq3k0UkJlg/VJL7YBWhIwI/AAAAAAAAJB0/9JVdU2Iiqs8/s1600/kibana1.png" alt="Kibana : Explorez vos données."><br>
</a><br>
<a href="http://4.bp.blogspot.com/-bhF7rAOdIWk/VJL7YDyzhLI/AAAAAAAAJB4/rkHhggrLNrs/s1600/kibana2.png" title="2"><br>
<img src="http://4.bp.blogspot.com/-bhF7rAOdIWk/VJL7YDyzhLI/AAAAAAAAJB4/rkHhggrLNrs/s1600/kibana2.png" alt="Kibana : Explorez vos données."><br>
</a><br>
<a href="http://1.bp.blogspot.com/-n8gAeiLX1ys/VJL7YBl092I/AAAAAAAAJCA/SodVO4jCNeI/s1600/kibana3.png" title="3"><br>
<img src="http://1.bp.blogspot.com/-n8gAeiLX1ys/VJL7YBl092I/AAAAAAAAJCA/SodVO4jCNeI/s1600/kibana3.png" alt="Kibana : Explorez vos données."><br>
</a></p>
<p>L’exploration de données et la réalisation de dashboard ne nécessitent aucun code, ce qui permet de donner la main aux fonctionnels ; De plus Kibana et Elastocsearch permettent d’avoir des rapports real time, se mettant à jour à mesure que les données sont stockées.</p>
<p>Pour les lecteurs qui connaissent bien la stack SQL Serveur, on pourrait le comparer à un Report Builder sous stéroïdes et surtout qui tiendrait (mieux) ses promesses de simplicités et d’accessibilité pour les non-techniciens</p>
<p>Je me propose dans ce billet de découvrir ensemble les fonctionnalités de « data discovering » sur un <a href="https://www.data.gouv.fr/fr/datasets/base-de-donnees-des-accidents-corporels-de-la-circulation/">dataset public</a> recensant les accidents corporels de la circulation</p>
<p>Si ces données vous intéressent, je vous invite d’ailleurs à jeter un œil à la très bonne session (<a href="https://www.youtube.com/watch?v=2rB7CbCVb1U">video</a>, <a href="https://onedrive.live.com/?cid=11D07374EB30D233&amp;id=11D07374EB30D233%21915">slides</a>) de <a href="http://patriceharel.blogspot.com/">Patrice Harel</a> sur le mining avec SSAS et qui s’appui sur le même jeu de données.</p>
<h1 id="installation">Installation</h1>
<p>Commençons par l’installation qui comme pour les autres composants de la stack est triviale :<br>
Tout commence évidement par le téléchargement du binaire <a href="http://www.elasticsearch.org/overview/kibana/installation/">ici</a>, suivi de la décompression de l’archive.<br>
Si votre instance elasticsearh ne tourne pas sur le même serveur qui hébergera Kibana ou si elle écoute sur un port non standard, il vous faudra modifier le fichier de configuration config/kibana.yml.<br>
Dans mon cas, je ne touche à rien!<br>
Puis à l’aide d’une fenêtre commande, il nous faudra exécuter /bin/kibana après s’être placé dans le répertoire ou a été décompressé l’archive.<br>
Finalement pointons notre navigateur sur l’url <a href="http://mah1979.qsandbox.com/#">http://localhost:5601</a></p>
<h1 id="exploration">Exploration</h1>
<p>S’il s’agit de la première fois que vous lancez Kibana, cet écran vous sera présenté, dans lequel il vous faudra choisir un index (équivalent de base de données) ainsi qu’une colonne typée date.<br>
Ce dernier point est extrêmement important, car Kibana part du principe qu’il est naturel pour l’esprit humain et plus facile de découvrir des données lorsqu’elles sont représentées sur une frise.<br>
<a href="http://1.bp.blogspot.com/-Z810eCg254A/VJL94zZOHZI/AAAAAAAAJCQ/8Z7RV0Y646s/s1600/kibana_configIndex.png" title="configure"><br>
<img src="http://1.bp.blogspot.com/-Z810eCg254A/VJL94zZOHZI/AAAAAAAAJCQ/8Z7RV0Y646s/s1600/kibana_configIndex.png" alt="Kibana : Explorez vos données."><br>
</a><br>
Dans notre dataset, nous ne disposons malheureusement pas de la date de l’accident, qui aurait été le candidat idéal en tant que « time field ».<br>
Pour l’exemple, nous nous rabattrons sur le champ @timestamp représentant l’instant ou a été inséré l’événement dans notre index.</p>
<p>On se retrouve propulsé dans nos données via l’écran suivant :<br>
<a href="http://2.bp.blogspot.com/-kmVU6veyAE0/VJL-Sxl_dwI/AAAAAAAAJCY/V6IOfdp5XuE/s1600/kibana_zones.png" title="explore"><br>
<img src="http://2.bp.blogspot.com/-kmVU6veyAE0/VJL-Sxl_dwI/AAAAAAAAJCY/V6IOfdp5XuE/s1600/kibana_zones.png" alt="Kibana : Explorez vos données."><br>
</a><br>
On reconnait très vite plusieurs sections dans cette interface :</p>
<ul>
<li>La colonne de gauche qui contient les champs à disposition (1).</li>
<li>Tout en haut (2), une zone de filtre ; n’oublions pas qu’elasticsearch est un moteur de recherche…</li>
<li>L’indicateur du nombre d’enregistrements après filtrage (3).</li>
<li>La frise temporelle sur laquelle on regarde les événements (4).</li>
<li>Finalement la vue tableau de données au centre. Notons que pour l’instant elle nous représente la version brute des données, car nous n’avons pas encore choisit de colonnes à afficher.</li>
</ul>
<p>Commençons par cliquer sur les barres du graph afin d’effectuer un drilldown au niveau temps.<br>
<a href="http://4.bp.blogspot.com/-IiU8s0EQj9k/VJL_V6DIH1I/AAAAAAAAJCk/rbUVL-Eq8Tw/s1600/kibana_timeseries.png" title="times series"><br>
<img src="http://4.bp.blogspot.com/-IiU8s0EQj9k/VJL_V6DIH1I/AAAAAAAAJCk/rbUVL-Eq8Tw/s1600/kibana_timeseries.png" alt="Kibana : Explorez vos données."><br>
</a><br>
Instantanément cela nous permet de découvrir la répartition des data dans le temps. Notez, que les clics que nous avons fait sur le graph sont interprétés comme une clause de filtrage, diminuant les événements auxquels on s’intéresse.</p>
<p>Pour avoir un aperçu du contenu des champs, je vous conseille de cliquer sur le nom d'un champ dans la colonne de gauche ; comme ceci :</p>
<p><img src="http://1.bp.blogspot.com/-F0lPUUYf2Ug/VJL_0oFOkmI/AAAAAAAAJCs/mELz1DPeLXs/s1600/kibana_FieldCount.png" alt="Kibana : Explorez vos données."></p>
<p>Les informations et actions présentées ici sont une vraie mine d’or.<br>
En plus d'un premier comptage des données sous-jacentes, on peut par exemple se concentrer sur les événements qui ont eu lieu sur l’A31 en cliquant sur l'icone loupe+. Evidemment, la frise temporelle et les données sont mis à jour.<br>
<a href="http://1.bp.blogspot.com/-pe2N46v18dE/VJMBPbsDBdI/AAAAAAAAJC4/GBDGOuzcuAo/s1600/kibana_filteredtimeseries.png" title="time series"><br>
<img src="http://1.bp.blogspot.com/-pe2N46v18dE/VJMBPbsDBdI/AAAAAAAAJC4/GBDGOuzcuAo/s1600/kibana_filteredtimeseries.png" alt="Kibana : Explorez vos données."><br>
</a></p>
<p>Maintenant, intéressons nous au champ tbl qui représente le nombre de blessés légers dans un accident.</p>
<p><img src="http://2.bp.blogspot.com/-J8qQtRTTLmk/VJMCR51JDmI/AAAAAAAAJDE/Nax3m2JrEuY/s1600/kibana_tbl.png" alt="Kibana : Explorez vos données."></p>
<p>En cliquant sur « Visualize », on obtient la répartition top 20, sous forme d’histogramme, du nombre de blessés légers sur l’ensemble des événements de la base.<br>
<a href="http://1.bp.blogspot.com/-42EKGG1e31g/VJMCs3vORDI/AAAAAAAAJDM/XfSnLY2gK0M/s1600/kibana_visualize.png" title="Visualize"><br>
<img src="http://1.bp.blogspot.com/-42EKGG1e31g/VJMCs3vORDI/AAAAAAAAJDM/XfSnLY2gK0M/s1600/kibana_visualize.png" alt="Kibana : Explorez vos données."><br>
</a><br>
Ici aussi cette visualisation, nous permet d’appréhender rapidement la teneur de nos données.</p>
<p>Finalement jetons un œil, au filtre qui se trouve tout en haut de l’interface de Kibana. Par défaut, vous y trouverez une *. Attention, il n’y a pas ici d’analogie avec SQL, ici l’étoile signifie sans filtre.<br>
Nous pourrions par exemple nous intéresser à une commune en particulier, celle de Cergy par exemple (95002). Il nous suffira pour ce faire de saisir le filtre suivant :</p>
<p>codeinsee:=95002</p>
<p><a href="http://4.bp.blogspot.com/-MH9KuJdcVgE/VJMJZbCPthI/AAAAAAAAJDk/47EQjYENWWI/s1600/kibana_QueryEqual.png" title="Equals filter"><br>
<img src="http://4.bp.blogspot.com/-MH9KuJdcVgE/VJMJZbCPthI/AAAAAAAAJDk/47EQjYENWWI/s1600/kibana_QueryEqual.png" alt="Kibana : Explorez vos données."><br>
</a><br>
Ou bien les accidents impliquant plus de 2 morts</p>
<p>ttué:&gt;2</p>
<p><a href="http://2.bp.blogspot.com/-Mdsx4ZiSjXw/VJMKCSepodI/AAAAAAAAJDs/leAErdXX-YE/s1600/kibana_QueryGreater.png" title="Greater filter"><br>
<img src="http://2.bp.blogspot.com/-Mdsx4ZiSjXw/VJMKCSepodI/AAAAAAAAJDs/leAErdXX-YE/s1600/kibana_QueryGreater.png" alt="Kibana : Explorez vos données."><br>
</a><br>
Ou encore les accidents impliquant plus de 2 morts dans l’Oise :</p>
<p>ttué:&gt;2 AND codeinsee [60000 TO 69999]</p>
<p><a href="http://3.bp.blogspot.com/-H-sa9wi4IHc/VJMIlgo0inI/AAAAAAAAJDc/QS_ApVYRcyI/s1600/kibana_QueryRange.png" title="Range filter"><br>
<img src="http://3.bp.blogspot.com/-H-sa9wi4IHc/VJMIlgo0inI/AAAAAAAAJDc/QS_ApVYRcyI/s1600/kibana_QueryRange.png" alt="Kibana : Explorez vos données."><br>
</a></p>
<p>Voila qui clos ce premier article sur Kibana, en espérant vous avoir donné envie d’essayer ce superbe outil.</p>
</div>]]></content:encoded></item><item><title><![CDATA[Série Elasticsearch]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Ce post fait office de sommaire à toute une série d’articles que j’ai bon espoir d’écrire sur cette toute fin d’année 2014 et le début 2015.</p>
<p>Mais pourquoi parler d’Elasticsearch, moi qui ne traite que de technos Microsoft sur ce blog?</p>
<p>Cela part du constat</p></div>]]></description><link>http://www.mymemoryleaks.fr/serie-elasticsearch/</link><guid isPermaLink="false">5a99b626f336bf15fc91af75</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Tue, 23 Dec 2014 09:37:00 GMT</pubDate><content:encoded><![CDATA[<div class="kg-card-markdown"><p>Ce post fait office de sommaire à toute une série d’articles que j’ai bon espoir d’écrire sur cette toute fin d’année 2014 et le début 2015.</p>
<p>Mais pourquoi parler d’Elasticsearch, moi qui ne traite que de technos Microsoft sur ce blog?</p>
<p>Cela part du constat qu’a mon humble avis, la stack BI Microsoft pèche sur deux points :</p>
<ul>
<li>Premièrement, il n’existe pas d’outils permettant une exploration décente des données non encore nettoyées, rangées, retraitées etc.… d’ailleurs, plus la volumétrie est importante et plus ce point est difficilement adressable.<br>
(i.e : sur de petites volumétries, j’en entends déjà me dire qu’Excel peut avoir ce rôle, avec un enchevêtrement de tableaux croisés dynamiques etc… )</li>
<li>L’outillage de reporting est assez pauvre et n’est vraiment pas penser pour être à destination des fonctionnels.<br>
Je m’explique Reporting Services fait le job lorsqu’il s’agit de réaliser un document pro format, mais nécessite des compétences techniques que nos fonctionnels ne disposent pas ; et c’est bien normal.<br>
Vous aurez probablement également entendu parler de la version « User Friendly » de « Reporting Services », j’ai nommé Report Builder. La tentative est louable, mais le résultat n’est pas la à hauteur.<br>
Encore une fois dans les faits, bien peut de fonctionnels ont les connaissances, l’envie et le temps de l’utiliser.</li>
</ul>
<p>C’est avec ces regrets dans l’âme, que je me retrouve lors de la conférence <a href="http://ncraft.io/">ncraft 2014</a> à assister à une superbe session d’<a href="http://code972.com/blog">Itamar Syn-Hershko</a> consacrée au couple Elasticsearch et Kibana.</p>
<p>Je vous passe les détails de <a href="https://www.youtube.com/watch?v=s_1IiYQyB20">cette présentation</a>, mais effet whaou garanti vers la fin de la session lorsque Kibana rentre en scène.</p>
<p>Certain doivent se dire qu’il m’a fallu presque 1 an pour commencer à sortir un article, quelle productivité !</p>
<p>Pour être tout à fait franc, il y a 1 an il manquait encore quelques features indispensable a mon sens pour que Kibana puisse jouer un rôle aussi important que ce pour quoi il à été conçu. L’exemple le plus probant était l’impossibilité de réaliser un « distinc count » ; un « show stopper » pour qui compte faire un peu de BI sérieusement.</p>
<p>Voila pour le petit historique et mes états d’âmes ; Kibana est arrivé à maturité selon moi dans ses cas d’utilisation standard et cela mérité bien qu’on s’y intéresse ainsi qu’a l’écosystème qui gravite autour.</p>
<p>Voici enfin l’heure du menu :</p>
<ul>
<li><a href="http://mah1979.qsandbox.com/kibana-explorez-vos-donnees/">1ere Partie : Explorez vos données avec Kibana</a></li>
<li>2eme Partie : Chargez vos données, les yeux fermés avec Logstash</li>
<li>3eme Partie : Introduction à Elasticsearch</li>
<li>4eme Partie : Changement de mapping et Reindexation</li>
<li>5eme Partie : Reporting avancé &amp; Dashbording (Kibana)</li>
<li>6eme Partie : Transformation de données (Logstash)</li>
</ul>
<p>Il y’a de forte chance que ce sommaire soit agrémenté d’autres articles dans le futur ; le domaine étant extrêmement large.</p>
<p>Dernier point, l’ordre des premiers articles peut vous paraître étrange ; j’ai voulu partir de ce qui apportera le plus de valeur ajouté aux fonctionnels pour finir par ce qui requiers le plus de compétences techniques.</p>
<p>Il ne me reste qu'a vous souhaiter une bonne lecture, et n'hésitez pas a me laisser vos commentaires.</p>
</div>]]></content:encoded></item><item><title><![CDATA[Utiliser Couchbase comme serveur de cache]]></title><description><![CDATA[<div class="kg-card-markdown"><p>Dernièrement, je vous présentais une façon simple d'utiliser le <a href="http://mah1979.qsandbox.com/poor-mans-cache/">cache dans vos applications .NET</a><br>
Cependant cette solution possède plusieurs inconvénients. En voici quelque uns :</p>
<ul>
<li>Le cache est lié au processus système de votre application (executable / IIS etc...). Si votre programme plante ou est fermé, vous perdez votre cache</li>
<li>Si vos</li></ul></div>]]></description><link>http://www.mymemoryleaks.fr/utiliser-couchbase-comme-serveur-de-cache/</link><guid isPermaLink="false">5a99b626f336bf15fc91af74</guid><dc:creator><![CDATA[Fabrice Michellonet]]></dc:creator><pubDate>Fri, 11 Apr 2014 13:13:00 GMT</pubDate><media:content url="http://mah1979.qsandbox.com/wp-content/uploads/2014/04/config_couchbase.png" medium="image"/><content:encoded><![CDATA[<div class="kg-card-markdown"><img src="http://mah1979.qsandbox.com/wp-content/uploads/2014/04/config_couchbase.png" alt="Utiliser Couchbase comme serveur de cache"><p>Dernièrement, je vous présentais une façon simple d'utiliser le <a href="http://mah1979.qsandbox.com/poor-mans-cache/">cache dans vos applications .NET</a><br>
Cependant cette solution possède plusieurs inconvénients. En voici quelque uns :</p>
<ul>
<li>Le cache est lié au processus système de votre application (executable / IIS etc...). Si votre programme plante ou est fermé, vous perdez votre cache</li>
<li>Si vos besoins en mémoire augmentent, cette solution n'est pas scalable</li>
<li>Rien n'est mis a disposition pour monitorer votre cache</li>
<li>Vous n'avez pas d'interface de gestion du cache (augmentation de la mémoire allouée etc...)</li>
<li>Vous ne pouvez pas invalider le cache sans arrêter l'application.</li>
<li>etc...</li>
</ul>
<p>Bref, vous avez compris, c'est une solution pour démarrer petit.</p>
<p>Aujourd'hui, je voudrais partager avec vous une solution qui répond à tous les manques évoqués plus haut et plus encore.<br>
Couchbase est une base NoSQL Key/Value; la value ayant comme particularité d'être un document json.<br>
Couchbase est issu du mariage heureux de Membase (cache mémoire avec réplication des caches, persistance et interface d’admin Web sexy) et<br>
CouchDB (NoSQL orienté document). Ce qui nous intéresse plus particulièrement aujourd'hui sont les fonctionnalités qui en font un bon serveur de cache.</p>
<h3 id="installation">Installation</h3>
<p>Pour l'installer, tout commence par <a href="http://www.couchbase.com/couchbase-server/overview">télécharger le setup ici</a></p>
<p>Je vous passe le scénario d'installation qui a le bon gout de se faire en &quot;Next&quot; &gt; &quot;Next&quot; &gt; &quot;Next&quot;</p>
<p>Passons à la configuration :</p>
<p>Dans la première étape, il vous faudra spécifier l'emplacement des fichiers (base et index) ainsi que la mémoire dévolue à Couchbase.</p>
<p><a href="http://3.bp.blogspot.com/-a9Gm-TdZhEk/U0fm0nM3eeI/AAAAAAAAGL8/5k4Wmmk2nNo/s1600/config_couchbase.png"><img src="http://3.bp.blogspot.com/-a9Gm-TdZhEk/U0fm0nM3eeI/AAAAAAAAGL8/5k4Wmmk2nNo/s1600/config_couchbase.png" alt="Utiliser Couchbase comme serveur de cache"></a></p>
<p>Un peu plus loin nous allons créer le l'espace qui accueillera les objets que l'on va mettre en cache (bucket).</p>
<p><a href="http://3.bp.blogspot.com/-wftJQDUu1Lw/U0fnPKiT2tI/AAAAAAAAGME/1Mk3vI8CflE/s1600/bucket.png"><img src="http://3.bp.blogspot.com/-wftJQDUu1Lw/U0fnPKiT2tI/AAAAAAAAGME/1Mk3vI8CflE/s1600/bucket.png" alt="Utiliser Couchbase comme serveur de cache"></a></p>
<p>Quelques instant plus tard vous voila avec un Couchbase flambant neuf sur votre machine.</p>
<p><a href="http://3.bp.blogspot.com/-MsQaiQROQuI/U0fniAPHxJI/AAAAAAAAGMM/QUZOAShtgKw/s1600/complete.png"><img src="http://3.bp.blogspot.com/-MsQaiQROQuI/U0fniAPHxJI/AAAAAAAAGMM/QUZOAShtgKw/s1600/complete.png" alt="Utiliser Couchbase comme serveur de cache"></a></p>
<p>Note : si la page ne s'ouvre pas automatiquement dans votre browser, la console d'admin de couchbase se trouve a l'adresse suivante : <a href="http://localhost:8091/">http://localhost:8091/</a></p>
<h3 id="implementation">Implementation</h3>
<p>Couchbase dispose d'un très bel écosystème qui gravite autour, et la plateforme .NET ne fait pas exception.<br>
Je me propose d'adapter le cache manager vu dans le <a href="http://mah1979.qsandbox.com/poor-mans-cache/">précédent article.</a><br>
Pour rappel nous avions l'interface suivante :</p>
<p>public interface ICacheManager { T GetOrInsert<t>(string key, Func<t> callback) where T : class; }</t></t></p>
<p>Passons à l'implémentation. Il va nous falloir un driver, que l'on peut aisément installer via <a href="http://www.nuget.org/">nuget</a> :</p>
<p><a href="http://1.bp.blogspot.com/--7tTMlX55hE/U0foFlp4VXI/AAAAAAAAGMU/SyojzYwUV5U/s1600/nuget_couchbase.png"><img src="http://1.bp.blogspot.com/--7tTMlX55hE/U0foFlp4VXI/AAAAAAAAGMU/SyojzYwUV5U/s1600/nuget_couchbase.png" alt="Utiliser Couchbase comme serveur de cache"></a></p>
<p>son utilisation est des plus simple, avec des méthodes explicites comme Get() et Store().<br>
Voici une implémentation de cache respectant notre interface basée sur Couchbase.</p>
<p>public class CouchbaseCacheManager : ICacheManager { private readonly CouchbaseClient _client; public CouchebaseCacheManager() { _client = new CouchbaseClient(); } public T GetOrInsert<t>(string key, Func<t> callback) where T : class { T elmnt; try { if (_client.KeyExists(key)) return _client.Get<t>(key); elmnt = callback(); _client.Store(StoreMode.Add, key, elmnt); } catch (Exception) { elmnt = callback(); } return elmnt; } }</t></t></t></p>
<p>Et vous, quel type de cache utilisez vous dans vos projets?</p>
</div>]]></content:encoded></item></channel></rss>
